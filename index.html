<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Familien Bro - Ukesmeny</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #fafaf9; color: #44403c; }
        
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            .print-only { display: block !important; }
        }
        
        .clickable-card:active { transform: scale(0.98); }
        .lunch-card:hover { filter: brightness(0.95); }
        
        .step-checked {
            text-decoration: line-through;
            color: #a8a29e;
            transition: all 0.3s ease;
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .timer-finished {
            animation: pulse-red 2s infinite;
            background-color: #7f1d1d;
            border-color: #ef4444;
        }
    </style>
</head>
<body>
    
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- LYDEFFEKT (Rolig alarm) ---
        const playCalmAlarm = () => {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const now = ctx.currentTime;
            const notes = [261.63, 329.63, 392.00]; 
            notes.forEach((freq, i) => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, now + (i * 0.2));
                gain.gain.setValueAtTime(0, now + (i * 0.2));
                gain.gain.linearRampToValueAtTime(0.3, now + (i * 0.2) + 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, now + (i * 0.2) + 1.5);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start(now + (i * 0.2));
                osc.stop(now + (i * 0.2) + 2);
            });
        };

        // --- LYDEFFEKT (Start Timer) ---
        const playStartSound = () => {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.setValueAtTime(440, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
            osc.start();
            osc.stop(ctx.currentTime + 0.1);
        };

        const Icon = ({ name, className }) => {
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [name]); 
            return <i data-lucide={name} className={className}></i>;
        };

        // --- TAG SEARCH INPUT COMPONENT ---
        const TagSearchInput = ({ tags, setTags, inputValue, setInputValue, placeholder }) => {
            const handleKeyDown = (e) => {
                if (e.key === 'Enter' || e.key === ',') {
                    e.preventDefault();
                    const trimmedInput = inputValue.trim();
                    if (trimmedInput && !tags.includes(trimmedInput)) {
                        setTags([...tags, trimmedInput]);
                        setInputValue('');
                    }
                } else if (e.key === 'Backspace' && !inputValue && tags.length > 0) {
                    setTags(tags.slice(0, -1));
                }
            };
            const removeTag = (tagToRemove) => {
                setTags(tags.filter(tag => tag !== tagToRemove));
            };
            return (
                <div className="flex flex-wrap items-center gap-2 w-full p-2 border border-stone-200 rounded-xl bg-white shadow-sm focus-within:ring-2 focus-within:ring-lime-500 focus-within:border-lime-500">
                    <div className="pl-2 pointer-events-none text-stone-400"><Icon name="search" className="h-5 w-5" /></div>
                    {tags.map((tag, index) => (
                        <span key={index} className="flex items-center gap-1 bg-lime-100 text-lime-800 px-2 py-1 rounded-md text-sm font-medium animate-fade-in">
                            {tag}
                            <button onClick={() => removeTag(tag)} className="hover:bg-lime-200 rounded-full p-0.5 transition-colors"><Icon name="x" className="w-3 h-3" /></button>
                        </span>
                    ))}
                    <input type="text" className="flex-grow min-w-[150px] outline-none text-stone-700 placeholder-stone-400 bg-transparent py-1" placeholder={tags.length === 0 ? placeholder : ""} value={inputValue} onChange={(e) => setInputValue(e.target.value)} onKeyDown={handleKeyDown} />
                </div>
            );
        };

        // --- FLERE TIMERE COMPONENT ---
        const FloatingTimerList = ({ activeTimers, setActiveTimers }) => {
            const alarmIntervalRef = useRef(null);
            const isRinging = activeTimers.some(t => t.finished && !t.acknowledged);

            useEffect(() => {
                const interval = setInterval(() => {
                    setActiveTimers(prevTimers => {
                        const updated = prevTimers.map(timer => {
                            if (!timer.active || timer.finished) return timer;
                            const newTime = timer.timeRemaining - 1;
                            if (newTime <= 0) {
                                return { ...timer, timeRemaining: 0, active: false, finished: true, acknowledged: false };
                            }
                            return { ...timer, timeRemaining: newTime };
                        });
                        localStorage.setItem('familienBro-timers', JSON.stringify(updated));
                        return updated;
                    });
                }, 1000);
                return () => clearInterval(interval);
            }, []);

            useEffect(() => {
                if (isRinging) {
                    if (!alarmIntervalRef.current) {
                        playCalmAlarm();
                        alarmIntervalRef.current = setInterval(() => playCalmAlarm(), 4000);
                    }
                } else {
                    if (alarmIntervalRef.current) {
                        clearInterval(alarmIntervalRef.current);
                        alarmIntervalRef.current = null;
                    }
                }
                return () => { if (alarmIntervalRef.current) clearInterval(alarmIntervalRef.current); };
            }, [isRinging]);

            if (activeTimers.length === 0) return null;

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            };
            const removeTimer = (id) => {
                const newTimers = activeTimers.filter(t => t.id !== id);
                setActiveTimers(newTimers);
                localStorage.setItem('familienBro-timers', JSON.stringify(newTimers));
            };
            const toggleTimer = (id) => {
                const newTimers = activeTimers.map(t => t.id === id ? {...t, active: !t.active} : t);
                setActiveTimers(newTimers);
                localStorage.setItem('familienBro-timers', JSON.stringify(newTimers));
            };
            const acknowledgeAlarm = (id) => {
                const newTimers = activeTimers.map(t => t.id === id ? {...t, acknowledged: true} : t);
                setActiveTimers(newTimers);
                localStorage.setItem('familienBro-timers', JSON.stringify(newTimers));
            };

            return (
                <div className="fixed bottom-4 right-4 flex flex-col gap-2 z-50 animate-fade-in items-end">
                    {activeTimers.map(timer => (
                        <div key={timer.id} className={`text-white p-3 rounded-xl shadow-lg flex items-center gap-3 border border-stone-700 min-w-[220px] justify-between transition-all duration-300 ${timer.finished && !timer.acknowledged ? 'timer-finished scale-105' : 'bg-stone-900'}`}>
                            <div className="flex flex-col">
                                <span className="text-[10px] text-stone-400 uppercase tracking-widest truncate max-w-[120px]">{timer.label}</span>
                                <span className="text-xl font-mono font-bold text-lime-400">{timer.finished ? "Tiden er ute!" : formatTime(timer.timeRemaining)}</span>
                            </div>
                            <div className="flex gap-1">
                                {timer.finished && !timer.acknowledged ? (
                                    <button onClick={() => acknowledgeAlarm(timer.id)} className="px-3 py-1.5 bg-red-600 hover:bg-red-500 text-white text-xs font-bold rounded-full animate-pulse">Skru av</button>
                                ) : (
                                    <>
                                        {!timer.finished && (
                                            <button onClick={() => toggleTimer(timer.id)} className="p-1.5 bg-stone-700 rounded-full hover:bg-stone-600"><Icon name={timer.active ? "pause" : "play"} className="w-4 h-4" /></button>
                                        )}
                                        <button onClick={() => removeTimer(timer.id)} className="p-1.5 bg-stone-700 rounded-full hover:bg-red-900/50 hover:text-red-400"><Icon name="x" className="w-4 h-4" /></button>
                                    </>
                                )}
                            </div>
                        </div>
                    ))}
                </div>
            );
        };

        // --- DATA ---
        const week1Data = [
            { day: "Mandag", theme: "Fet fisk & Omega-3", lunchKid: "Fullkornslefse med snøfrisk & røkelaks", lunchAdult: "Rester av søndagsmiddag (eller salat)", dinner: "Ovnsbakt laks med rotgrønnsaker & tzatziki", iconName: "fish", color: "text-sky-600", image: "https://images.unsplash.com/photo-1485921325833-c519f76c4927?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Ovnsbakt laks & rotgrønt", image: "https://images.unsplash.com/photo-1485921325833-c519f76c4927?q=80&w=800&auto=format&fit=crop", desc: "Alt i én form - minimalt med oppvask!", servings: 4, time: "30 min", timers: [{ label: "Bak grønnsaker", minutes: 10 }, { label: "Bak laksen ferdig", minutes: 12 }], nutrition: { calories: "520", protein: "38g", fat: "28g", carbs: "25g" }, ingredients: ["4 laksefileter", "2 søtpoteter", "2 gulrøtter", "1 brokkoli", "Olivenolje", "Sitronpepper", "Tzatziki eller rømme"], steps: ["Sett ovnen på 200 grader.", "Kutt grønnsaker i biter og legg i en ildfast form.", "Hell over litt olje og krydder. Bak i 10 min.", "Legg laksestykkene oppå grønnsakene.", "Bak videre i ca 12-15 min til laksen er ferdig.", "Server med en klatt tzatziki."] }, lunchKid: { title: "Laksewraps", image: "https://images.unsplash.com/photo-1626700051175-6818013e1d4f?q=80&w=800&auto=format&fit=crop", desc: "Enkel måte å få i barna fisk på.", servings: 1, time: "5 min", nutrition: { calories: "280", protein: "14g", fat: "15g", carbs: "22g" }, ingredients: ["1 fullkornslefse/tortilla", "1 ss Snøfrisk", "2 skiver røkelaks", "Litt spinat"], steps: ["Smør lefsen med kremost.", "Legg på laks og grønt.", "Rull tett sammen."] }, lunchAdult: null } },
            { day: "Tirsdag", theme: "Kjøttfri & Tarmhelse", lunchKid: "Grovbrød med hummus, paprika & druer", lunchAdult: "Rester av Laks (fra mandag)", dinner: "Kremet linsegryte med kokosmelk & nanbrød", iconName: "leaf", color: "text-lime-700", image: "https://images.unsplash.com/photo-1547592180-85f173990554?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Kremet linsegryte", image: "https://images.unsplash.com/photo-1547592180-85f173990554?q=80&w=800&auto=format&fit=crop", desc: "En varmende gryte full av fiber og gode smaker.", servings: 4, time: "20 min", timers: [{ label: "Koke linser", minutes: 15 }], nutrition: { calories: "410", protein: "19g", fat: "14g", carbs: "48g" }, ingredients: ["2 dl røde linser (tørre)", "1 boks kokosmelk", "1 boks hakkede tomater", "1 løk + 2 fedd hvitløk", "1 pose spinat", "1 ts ingefær", "Nanbrød til servering"], steps: ["Fres hakket løk, hvitløk og ingefær i litt olje.", "Tilsett linser, tomater og kokosmelk. Kok opp.", "La småkoke i 15 min til linsene er møre.", "Rør inn spinaten helt til slutt så den faller sammen.", "Smak til med salt/pepper. Server med nanbrød."] }, lunchKid: { title: "Hummus-skiver & grønt", image: "https://images.unsplash.com/photo-1621532982823-3b1a26d7f6c3?q=80&w=800&auto=format&fit=crop", desc: "Næringsrik lunsj som holder blodsukkeret stabilt.", servings: 1, time: "5 min", nutrition: { calories: "320", protein: "11g", fat: "13g", carbs: "38g" }, ingredients: ["2 skiver grovbrød", "3 ss hummus (kjøpt eller hjemmelaget)", "Paprikastaver", "En liten neve druer"], steps: ["Smør et godt lag hummus på brødskivene.", "Kutt paprika i staver som er lette å spise.", "Legg ved druer i matboksen."] }, lunchAdult: { title: "Lakse-salat (rester)", image: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?q=80&w=800", desc: "Bruk restene fra mandag!", servings: 1, time: "5 min", nutrition: { calories: "400", protein: "30g", fat: "20g", carbs: "15g" }, ingredients: ["Kald laks", "Ruccola/Spinat", "Agurk", "Dressing"], steps: ["Bland laks og grønnsaker."] } } },
            { day: "Onsdag", theme: "Kylling & Fullkorn", lunchKid: "Havrelapper med brunost & gulrot", lunchAdult: "Rester av Linsegryte", dinner: "Kyllingpanne med pesto & fullkornspasta", iconName: "utensils-crossed", color: "text-orange-600", image: "https://images.unsplash.com/photo-1473093295043-cdd812d0e601?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Kyllingpanne med pesto", image: "https://images.unsplash.com/photo-1473093295043-cdd812d0e601?q=80&w=800&auto=format&fit=crop", desc: "Rask hverdagsmiddag som barna elsker.", servings: 4, time: "20 min", timers: [{ label: "Koke pasta", minutes: 10 }, { label: "Surre kylling & tomat", minutes: 2 }], nutrition: { calories: "580", protein: "42g", fat: "22g", carbs: "48g" }, ingredients: ["400g kyllingfilet", "300g fullkornspasta", "1 glass grønn pesto", "1 pk cherrytomater", "Parmesan"], steps: ["Kok pasta.", "Stek kyllingbiter gylne.", "Del tomatene i to og la dem surre med kyllingen.", "Bland ferdig pasta med pesto, kylling og tomater."] }, lunchKid: { title: "Grove havrelapper", image: "https://images.unsplash.com/photo-1575853121743-60c24f0a7502?q=80&w=800&auto=format&fit=crop", desc: "Lag røren kvelden før for superrask steking om morgenen.", servings: 1, time: "15 min", nutrition: { calories: "220", protein: "9g", fat: "7g", carbs: "28g" }, ingredients: ["1 egg", "1 dl havregryn", "0.5 dl melk", "0.5 ts bakepulver"], steps: ["Bland ingrediensene og la svelle.", "Stek små lapper i pannen."] }, lunchAdult: { title: "Linsegryte (rester)", image: "https://images.unsplash.com/photo-1547592180-85f173990554?q=80&w=800", desc: "Varm opp i mikroen.", servings: 1, time: "2 min", nutrition: { calories: "410", protein: "19g", fat: "14g", carbs: "48g" }, ingredients: ["Linsegryte", "Nanbrød"], steps: ["Varm opp."] } } },
            { day: "Torsdag", theme: "Suppe & Raske løsninger", lunchKid: "Grovbrød med leverpostei & rødbeter", lunchAdult: "Salat med ruccola, avokado & kikerter", dinner: "Hjemmelaget tomatsuppe med egg (og linser!)", iconName: "chef-hat", color: "text-red-500", image: "https://images.unsplash.com/photo-1576098762557-4f0165780287?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: 'Tomatsuppe med "skjulte" linser', image: "https://images.unsplash.com/photo-1576098762557-4f0165780287?q=80&w=800&auto=format&fit=crop", desc: 'En superhelt-suppe som lurer inn masse næring!', servings: 4, time: "25 min", timers: [{ label: "Koke suppe", minutes: 20 }, { label: "Koke egg", minutes: 9 }], nutrition: { calories: "340", protein: "16g", fat: "12g", carbs: "36g" }, ingredients: ["1 ss olivenolje", "1 løk & 2 fedd hvitløk", "2 gulrøtter", "1 dl røde linser", "2 bokser hakkede tomater", "8 dl kraft"], steps: ["Stek løk, hvitløk og gulrot.", "Tilsett tomater, kraft og linser. Kok opp.", "La småkoke i 15-20 min.", "Kjør glatt med stavmikser. Server med egg."] }, lunchKid: { title: "Leverpostei-skive", image: "https://images.unsplash.com/photo-1603048588665-791ca8aea617?q=80&w=800&auto=format&fit=crop", desc: "Klassikeren med masse jern.", servings: 1, time: "3 min", nutrition: { calories: "260", protein: "11g", fat: "11g", carbs: "26g" }, ingredients: ["2 skiver grovbrød", "Leverpostei", "Sylteagurk/rødbeter"], steps: ["Smør brødet og pynt med grønt."] }, lunchAdult: { title: "Grønn kikertsalat", image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?q=80&w=800&auto=format&fit=crop", desc: "Enkel, mettende og vegansk.", servings: 1, time: "5 min", nutrition: { calories: "360", protein: "13g", fat: "22g", carbs: "24g" }, ingredients: ["Ruccola", "1/2 avokado", "1/2 boks kikerter", "Gresskarkjerner", "Olivenolje"], steps: ["Bland alt sammen i en boks.", "Hell over litt olje."] } } },
            { day: "Fredag", theme: "Fisketaco (Middelhavs-vri)", lunchKid: "Pastasalat med mais & eple", lunchAdult: "Omelett med spinat & fetaost", dinner: "Fisketaco med torsk & mangosalsa", iconName: "fish", color: "text-purple-600", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Fisketaco med torsk", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800&auto=format&fit=crop", desc: "En frisk og sunn start på helgen.", servings: 4, time: "25 min", nutrition: { calories: "480", protein: "32g", fat: "16g", carbs: "46g" }, ingredients: ["500g torskefilet", "Tacokrydder", "Tortillas", "1 mango", "1/2 rødkål", "Rømme", "Lime"], steps: ["Del torsken i terninger og stek med tacokrydder.", "Kutt opp mango og rødkål.", "Varm tortillaene.", "Server som taco."] }, lunchKid: { title: "Pastasalat", image: "https://images.unsplash.com/photo-1623428187969-5da2dcea5ebf?q=80&w=800&auto=format&fit=crop", desc: "Perfekt måte å bruke opp rester av pasta.", servings: 1, time: "5 min", nutrition: { calories: "290", protein: "9g", fat: "9g", carbs: "40g" }, ingredients: ["Kokt pasta", "Mais", "Eple", "Agurk"], steps: ["Bland alt sammen."] }, lunchAdult: { title: "Spinatomelett", image: "https://images.unsplash.com/photo-1510693206972-df098062cb71?q=80&w=800&auto=format&fit=crop", desc: "Proteinrik lunsj.", servings: 1, time: "10 min", nutrition: { calories: "310", protein: "21g", fat: "24g", carbs: "4g" }, ingredients: ["2 egg", "Spinat", "Fetaost"], steps: ["Stek spinat raskt.", "Hell over eggene og dryss med feta."] } } }
        ];

        const week2Data = [
            { day: "Mandag", theme: "Fisk & Ingefær-kick", lunchKid: "Matmuffins med ost og skinke", lunchAdult: "Caprese-salat med tomat & mozzarella", dinner: "Laks med ingefær, soya & sesam", iconName: "fish", color: "text-rose-600", image: "https://images.unsplash.com/photo-1543826173-70651703c5a4?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Ingefær-glasert Laks", image: "https://images.unsplash.com/photo-1543826173-70651703c5a4?q=80&w=800&auto=format&fit=crop", desc: "Smaksrik fiskemiddag som lager seg selv i ovnen.", servings: 4, time: "20 min", timers: [{ label: "Bake laks", minutes: 15 }], nutrition: { calories: "550", protein: "38g", fat: "30g", carbs: "22g" }, ingredients: ["4 laksefileter", "3 ss soyasaus", "1 ss honning", "1 ss revet ingefær", "Sesamfrø", "Brokkoli", "Ris/Nudler"], steps: ["Bland soya, honning og ingefær.", "Legg laksen i form og hell sausen over.", "Bak i ovnen på 200 grader i 12-15 min.", "Strø over sesamfrø ved servering."] }, lunchKid: { title: "Matmuffins", image: "https://images.unsplash.com/photo-1620063251786-b4d618d35091?q=80&w=800", desc: "Lag opp på søndag - holder hele uken!", servings: 12, time: "30 min", timers: [{ label: "Steke muffins", minutes: 18 }], nutrition: { calories: "180", protein: "8g", fat: "10g", carbs: "15g" }, ingredients: ["3 egg", "3 dl mel", "1 ts bakepulver", "100g skinke", "100g revet ost", "1 dl melk"], steps: ["Bland egg og melk.", "Rør inn det tørre og fyllet.", "Stek i muffinsformer på 200 grader i ca 15-20 min."] }, lunchAdult: { title: "Caprese Salat", image: "https://images.unsplash.com/photo-1529312266912-b33cf6227e2f?q=80&w=800&auto=format&fit=crop", desc: "Enkelt, friskt og italiensk.", servings: 1, time: "5 min", nutrition: { calories: "320", protein: "18g", fat: "24g", carbs: "6g" }, ingredients: ["1 mozzarella-ball", "2 tomater", "Fersk basilikum", "Olivenolje", "Balsamico"], steps: ["Skjær tomat og mozzarella i skiver.", "Legg lagvis på tallerken.", "Topp med basilikum, olje og litt salt."] } } },
            { day: "Tirsdag", theme: "Gresk Aften", lunchKid: "Fullkornspasta med grønn pesto & erter", lunchAdult: "Rester av Ingefær-laks", dinner: "Kylling Souvlaki med Tzatziki", iconName: "utensils-crossed", color: "text-sky-700", image: "https://images.unsplash.com/photo-1532592309856-1c32483864b4?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Kylling Souvlaki", image: "https://images.unsplash.com/photo-1532592309856-1c32483864b4?q=80&w=800&auto=format&fit=crop", desc: "Greske smaker som barna liker.", servings: 4, time: "25 min", nutrition: { calories: "450", protein: "42g", fat: "18g", carbs: "30g" }, ingredients: ["400g kyllingfilet", "Oregano", "Sitron", "Hvitløk", "Tzatziki", "Pita/Lefser", "Agurk & Tomat"], steps: ["Mariner kyllingbiter i olje, sitron og oregano.", "Stek i panne eller på spyd i ovnen.", "Server i pita med tzatziki og salat."] }, lunchKid: { title: "Pesto-pasta", image: "https://images.unsplash.com/photo-1473093295043-cdd812d0e601?q=80&w=800", desc: "Kald pasta er super matpakke-mat.", servings: 1, time: "5 min", nutrition: { calories: "350", protein: "10g", fat: "12g", carbs: "50g" }, ingredients: ["Kokt pasta", "1 ss pesto", "Frosne erter (tiner i boksen)"], steps: ["Bland pasta med pesto og erter.", "Legg gjerne ved noen cherrytomater."] }, lunchAdult: { title: "Laks & Brokkoli (rester)", image: "https://images.unsplash.com/photo-1543826173-70651703c5a4?q=80&w=800", desc: "Smakene setter seg enda bedre til i dag.", servings: 1, time: "2 min", nutrition: { calories: "550", protein: "38g", fat: "30g", carbs: "22g" }, ingredients: ["Laks", "Ris", "Brokkoli"], steps: ["Varm opp."] } } },
            { day: "Onsdag", theme: "Suppe-onsdag", lunchKid: "Yoghurt med granola & bær + knekkebrød", lunchAdult: "Kylling-wrap (rester fra tirsdag)", dinner: "Hvit Minestronesuppe med bønner", iconName: "chef-hat", color: "text-emerald-600", image: "https://images.unsplash.com/photo-1620916566398-39f1143ab7be?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Hvit Minestrone", image: "https://images.unsplash.com/photo-1620916566398-39f1143ab7be?q=80&w=800&auto=format&fit=crop", desc: "En lys og lett suppe full av grønnsaker.", servings: 4, time: "20 min", timers: [{ label: "Koke poteter møre", minutes: 15 }], nutrition: { calories: "320", protein: "16g", fat: "8g", carbs: "42g" }, ingredients: ["1 boks hvite bønner", "Poteter i terninger", "Gulrot", "Stangselleri", "Grønnsakskraft", "Litt pasta/makaroni"], steps: ["Kutt alle grønnsaker i små terninger.", "Fres i gryta.", "Hell på kraft og kok til potetene er møre.", "Ha i bønner og pasta mot slutten."] }, lunchKid: { title: "Yoghurt-lunsj", image: "https://images.unsplash.com/photo-1488477181946-6428a0291777?q=80&w=800", desc: "Friskt og godt.", servings: 1, time: "2 min", nutrition: { calories: "300", protein: "15g", fat: "8g", carbs: "40g" }, ingredients: ["Naturell yoghurt", "Granola", "Bær", "1 knekkebrød med ost"], steps: ["Ha yoghurt i tett boks, granola ved siden av."] }, lunchAdult: { title: "Kylling i pita (rester)", image: "https://images.unsplash.com/photo-1532592309856-1c32483864b4?q=80&w=800", desc: "Kald souvlaki er digg!", servings: 1, time: "2 min", nutrition: { calories: "450", protein: "42g", fat: "18g", carbs: "30g" }, ingredients: ["Kylling", "Pita", "Tzatziki"], steps: ["Pakk inn restene."] } } },
            { day: "Torsdag", theme: "Anti-inflammatorisk & Gurkemeie", lunchKid: "Fiskekaker i lompe/grovbrød", lunchAdult: "Tunfisksalat med egg & rødløk", dinner: "Gyllen kikertgryte med gurkemeie", iconName: "leaf", color: "text-amber-600", image: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Gyllen kikertgryte", image: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?q=80&w=800&auto=format&fit=crop", desc: "En sunn middag med kraften fra gurkemeie.", servings: 4, time: "25 min", timers: [{ label: "Småkoke", minutes: 15 }], nutrition: { calories: "380", protein: "14g", fat: "12g", carbs: "45g" }, ingredients: ["2 bokser kikerter", "1 ss gurkemeie", "1 boks kokosmelk", "1 løk", "Ingefær (fersk)", "Spinat", "Ris til servering"], steps: ["Fres løk, hvitløk og revet ingefær i olje.", "Tilsett gurkemeie og la det frese litt.", "Ha i kikerter og kokosmelk. La småkoke i 15 min.", "Vend inn spinat før servering."] }, lunchKid: { title: "Fiskekake-lunsj", image: "https://images.unsplash.com/photo-1565557623262-b51c2513a641?q=80&w=800", desc: "Kald fiskekake er bedre enn du tror!", servings: 1, time: "1 min", nutrition: { calories: "250", protein: "15g", fat: "10g", carbs: "25g" }, ingredients: ["1-2 fiskekaker", "1 lompe eller brødskive", "Ketchup?"], steps: ["Pakk fiskekaken i lompe eller ha på brød."] }, lunchAdult: { title: "Tunfisksalat", image: "https://images.unsplash.com/photo-1543340904-991f3751a30f?q=80&w=800", desc: "Proteinbombe.", servings: 1, time: "10 min", nutrition: { calories: "380", protein: "40g", fat: "18g", carbs: "10g" }, ingredients: ["1 boks tunfisk", "1 kokt egg", "Rødløk", "Salatblader", "Litt majones/rømme"], steps: ["Bland tunfisk med hakket rødløk og litt dressing.", "Server på en seng av salat med eggbåter."] } } },
            { day: "Fredag", theme: "Middelhavs-Taco", lunchKid: "Polarbrød-pizza (kald)", lunchAdult: "Omelett med tomat & basilikum", dinner: "Halloumi-tacos med mangosalsa", iconName: "smile", color: "text-orange-500", image: "https://images.unsplash.com/photo-1551504734-5ee1c4a1479b?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Halloumi-tacos", image: "https://images.unsplash.com/photo-1551504734-5ee1c4a1479b?q=80&w=800&auto=format&fit=crop", desc: "En morsom vri på fredagstacoen.", servings: 4, time: "20 min", nutrition: { calories: "560", protein: "24g", fat: "38g", carbs: "34g" }, ingredients: ["1 pk Halloumi-ost", "Små tortillas", "1 mango", "Avokado/Guacamole", "Chili", "Lime"], steps: ["Kutt mango og avokado i terninger (salsa).", "Stek skiver av halloumi i pannen til gylne.", "Server i varme tortillas med salsa og lime."] }, lunchKid: { title: "Polarbrød-pizza", image: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?q=80&w=800", desc: "Lages kvelden før eller om morgenen.", servings: 1, time: "10 min", nutrition: { calories: "320", protein: "14g", fat: "12g", carbs: "35g" }, ingredients: ["Polarbrød", "Tomatpuré", "Ost", "Skinke"], steps: ["Smør tomatpuré på polarbrød.", "Ha på ost og skinke.", "Gratiner i ovnen til osten smelter. Avkjøl."] }, lunchAdult: { title: "Tomat-omelett", image: "https://images.unsplash.com/photo-1510693206972-df098062cb71?q=80&w=800", desc: "Enkel proteinlunsj.", servings: 1, time: "10 min", nutrition: { calories: "300", protein: "20g", fat: "22g", carbs: "5g" }, ingredients: ["2 egg", "Tomater", "Basilikum", "Parmesan"], steps: ["Pisk egg.", "Stek i panne med tomater.", "Topp med urter."] } } }
        ];

        // --- NEW WEEKS DATA ---
        const week3Data = [
            { day: "Mandag", theme: "Raske Fiskekaker", lunchKid: "Yoghurt & Banan", lunchAdult: "Restesalat", dinner: "Fiskekaker med råkost og poteter", iconName: "fish", color: "text-blue-600", image: "https://images.unsplash.com/photo-1565557623262-b51c2513a641?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Fiskekaker med råkost", image: "https://images.unsplash.com/photo-1565557623262-b51c2513a641?q=80&w=800&auto=format&fit=crop", desc: "Klassiker som alle liker. Ferdige fiskekaker gjør det raskt.", servings: 4, time: "20 min", timers: [{ label: "Koke poteter", minutes: 20 }], nutrition: { calories: "450", protein: "25g", fat: "15g", carbs: "40g" }, ingredients: ["800g Fiskekaker", "8-10 Poteter", "3 Gulrøtter", "1 Eple", "Sitron", "Rømme"], steps: ["Kok poteter i lettsaltet vann.", "Riv gulrøtter og eple til råkost. Press over sitron.", "Varm fiskekakene i pannen med litt smør."] }, lunchKid: { title: "Yoghurt & Banan", image: "https://images.unsplash.com/photo-1488477181946-6428a0291777?q=80&w=800", desc: "Enkelt og greit.", servings: 1, time: "2 min", ingredients: ["Yoghurt", "1 Banan", "Litt musli"], steps: ["Bland og spis."] }, lunchAdult: { title: "Restesalat", image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?q=80&w=800", desc: "Bruk helgens rester.", servings: 1, time: "5 min", ingredients: ["Salat", "Rester"], steps: ["Bland."] } } },
            { day: "Tirsdag", theme: "Vegetar-fest", lunchKid: "Ostesmørbrød", lunchAdult: "Fiskekake på skive", dinner: "Vegetarlasagne med linser", iconName: "leaf", color: "text-green-600", image: "https://images.unsplash.com/photo-1574868302505-1a98629a8a7c?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Vegetarlasagne", image: "https://images.unsplash.com/photo-1574868302505-1a98629a8a7c?q=80&w=800&auto=format&fit=crop", desc: "Mettende lasagne der kjøttdeig er byttet ut med røde linser.", servings: 4, time: "45 min", timers: [{ label: "Steke lasagne", minutes: 30 }], nutrition: { calories: "520", protein: "22g", fat: "20g", carbs: "55g" }, ingredients: ["Lasagneplater", "2 bokser hakkede tomater", "2 dl røde linser", "1 løk", "Hvit saus/Bechamel", "Ost"], steps: ["Lag tomatsaus med linser, løk og krydder.", "Legg lagvis med plater og hvit saus.", "Topp med ost. Stek på 200 grader."] }, lunchKid: { title: "Ostesmørbrød", image: "https://images.unsplash.com/photo-1588612455956-2582855f308a?q=80&w=800", desc: "Varm lunsj er luksus.", servings: 1, time: "10 min", ingredients: ["Brød", "Ost", "Skinke", "Ketchup"], steps: ["Stek i ovn eller pannes."] }, lunchAdult: { title: "Fiskekake-skive", image: "https://images.unsplash.com/photo-1565557623262-b51c2513a641?q=80&w=800", desc: "Rester fra mandag.", servings: 1, time: "2 min", ingredients: ["Fiskekake", "Brød", "Majones"], steps: ["Legg på brød."] } } },
            { day: "Onsdag", theme: "Kylling Wok", lunchKid: "Smoothie & Knekkebrød", lunchAdult: "Lasagne-rester", dinner: "Kyllingwok med nudler", iconName: "utensils-crossed", color: "text-orange-600", image: "https://images.unsplash.com/photo-1585032226651-759b368d7246?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Kyllingwok", image: "https://images.unsplash.com/photo-1585032226651-759b368d7246?q=80&w=800&auto=format&fit=crop", desc: "Masse grønnsaker og raskt ferdig.", servings: 4, time: "20 min", timers: [{ label: "Koke nudler", minutes: 4 }], nutrition: { calories: "480", protein: "35g", fat: "12g", carbs: "50g" }, ingredients: ["400g Kylling", "Nudler", "Wok-blanding (frossen er ok)", "Soyasaus", "Chili (valgfritt)"], steps: ["Kok nudler.", "Stek kylling i strimler.", "Ha i grønnsaker og fres raskt.", "Bland alt med soya."] }, lunchKid: { title: "Smoothie", image: "https://images.unsplash.com/photo-1505252585461-04db1eb84625?q=80&w=800", desc: "Vitaminbombe.", servings: 1, time: "5 min", ingredients: ["Frosne bær", "Banan", "Juice/Melk"], steps: ["Kjør i blender."] }, lunchAdult: { title: "Lasagne-lunsj", image: "https://images.unsplash.com/photo-1574868302505-1a98629a8a7c?q=80&w=800", desc: "Bedre dagen etter.", servings: 1, time: "3 min", ingredients: ["Lasagne"], steps: ["Varm opp."] } } },
            { day: "Torsdag", theme: "Suppe-torsdag", lunchKid: "Eggemuffins", lunchAdult: "Wok-rester", dinner: "Kremet Blomkålsuppe", iconName: "chef-hat", color: "text-yellow-600", image: "https://images.unsplash.com/photo-1547592166-23ac45744acd?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Blomkålsuppe", image: "https://images.unsplash.com/photo-1547592166-23ac45744acd?q=80&w=800&auto=format&fit=crop", desc: "Hjemmelaget er best!", servings: 4, time: "25 min", timers: [{ label: "Koke blomkål", minutes: 15 }], nutrition: { calories: "250", protein: "8g", fat: "15g", carbs: "12g" }, ingredients: ["2 Blomkålhoder", "1 Løk", "8dl Kraft", "2dl Fløte/Melk", "Bacon (topping)"], steps: ["Stek løk.", "Ha i blomkål og kraft. Kok mørt.", "Kjør glatt med stavmikser (ta av noen buketter først).", "Rør inn fløte. Server med sprøstekt bacon."] }, lunchKid: { title: "Eggemuffins", image: "https://images.unsplash.com/photo-1525351484163-7529414395d8?q=80&w=800", desc: "Egg og grønnsaker i form.", servings: 1, time: "20 min", ingredients: ["Egg", "Spinat", "Ost"], steps: ["Visp sammen, stek i muffinsform."] }, lunchAdult: { title: "Wok-lunsj", image: "https://images.unsplash.com/photo-1585032226651-759b368d7246?q=80&w=800", desc: "Kald eller varm.", servings: 1, time: "2 min", ingredients: ["Wok"], steps: ["Spis."] } } },
            { day: "Fredag", theme: "Hjemmelaget Pizza", lunchKid: "Suppe på termos", lunchAdult: "Salat med egg", dinner: "Grov Pizza med spekeskinke", iconName: "smile", color: "text-red-600", image: "https://images.unsplash.com/photo-1513104890138-7c749659a591?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Grov Pizza", image: "https://images.unsplash.com/photo-1513104890138-7c749659a591?q=80&w=800&auto=format&fit=crop", desc: "Litt sunnere fredagskos.", servings: 4, time: "40 min", timers: [{ label: "Heve deig", minutes: 20 }, { label: "Steke pizza", minutes: 15 }], nutrition: { calories: "600", protein: "28g", fat: "22g", carbs: "65g" }, ingredients: ["Fullkornsmel", "Gjær", "Tomatsaus", "Mozzarella", "Spekeskinke", "Ruccola"], steps: ["Lag deig og la heve.", "Kjevle ut, ha på saus og ost.", "Stek på 225 grader.", "Legg på skinke og ruccola etter steking."] }, lunchKid: { title: "Termos-suppe", image: "https://images.unsplash.com/photo-1547592166-23ac45744acd?q=80&w=800", desc: "Resten av blomkålsuppa.", servings: 1, time: "2 min", ingredients: ["Suppe"], steps: ["Varm opp og ha på termos."] }, lunchAdult: { title: "Eggesalat", image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?q=80&w=800", desc: "Enkel salat.", servings: 1, time: "5 min", ingredients: ["Salat", "Egg", "Tomat"], steps: ["Bland."] } } }
        ];

        const week4Data = [
            { day: "Mandag", theme: "Torsk i form", lunchKid: "Pizzasnurrer (rester)", lunchAdult: "Pizzarest", dinner: "Torsk i form med pesto", iconName: "fish", color: "text-blue-500", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Torsk med pesto", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800&auto=format&fit=crop", desc: "Superenkel fiskemiddag.", servings: 4, time: "25 min", timers: [{ label: "Ovnsbake", minutes: 15 }], nutrition: { calories: "420", protein: "35g", fat: "25g", carbs: "10g" }, ingredients: ["600g Torskefilet", "Grønn pesto", "Cherrytomater", "Fløte", "Ris/Potet"], steps: ["Legg fisk i form.", "Smør på pesto, ha i tomater og en skvett fløte.", "Bak på 200 grader i ca 15 min."] }, lunchKid: { title: "Pizzasnurr", image: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?q=80&w=800", desc: "Fra fredag.", servings: 1, time: "0 min", ingredients: ["Pizza"], steps: ["Spis."] }, lunchAdult: { title: "Kald pizza", image: "https://images.unsplash.com/photo-1513104890138-7c749659a591?q=80&w=800", desc: "Frokostpizza til lunsj?", servings: 1, time: "0 min", ingredients: ["Pizza"], steps: ["Nyt."] } } },
            { day: "Tirsdag", theme: "Chili Sin Carne", lunchKid: "Brødskive m/leverpostei", lunchAdult: "Torske-rester", dinner: "Chili Sin Carne", iconName: "leaf", color: "text-red-700", image: "https://images.unsplash.com/photo-1526318896980-cf78c088247c?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Chili Sin Carne", image: "https://images.unsplash.com/photo-1526318896980-cf78c088247c?q=80&w=800&auto=format&fit=crop", desc: "Kjøttfri chili med bønner og sjokolade (!).", servings: 4, time: "30 min", timers: [{ label: "Koke gryte", minutes: 20 }], nutrition: { calories: "380", protein: "18g", fat: "10g", carbs: "45g" }, ingredients: ["2 bokser Kidneybønner", "1 boks tomater", "Løk & Hvitløk", "Chili", "Paprika", "Mais", "Mørk sjokolade (1 bit)", "Ris"], steps: ["Fres løk, hvitløk og chili.", "Ha i tomater og bønner. Kok opp.", "Smak til med krydder og en bit sjokolade.", "Server med ris."] }, lunchKid: { title: "Leverpostei", image: "https://images.unsplash.com/photo-1603048588665-791ca8aea617?q=80&w=800", desc: "Klassisk.", servings: 1, time: "2 min", ingredients: ["Brød", "Leverpostei"], steps: ["Smør."] }, lunchAdult: { title: "Fiskelunsj", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800", desc: "Rester.", servings: 1, time: "2 min", ingredients: ["Torsk"], steps: ["Varm."] } } },
            { day: "Onsdag", theme: "Tradisjon", lunchKid: "Fruktbeger", lunchAdult: "Chili-rester", dinner: "Kjøttkaker i brun saus", iconName: "utensils-crossed", color: "text-amber-800", image: "https://images.unsplash.com/photo-1555939594-58d7cb561ad1?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Kjøttkaker", image: "https://images.unsplash.com/photo-1555939594-58d7cb561ad1?q=80&w=800&auto=format&fit=crop", desc: "Norsk tradisjonsmat.", servings: 4, time: "30 min", timers: [{ label: "Trekke kjøttkaker", minutes: 10 }, { label: "Koke poteter", minutes: 20 }], nutrition: { calories: "550", protein: "25g", fat: "30g", carbs: "40g" }, ingredients: ["Kjøttdeig", "Poteter", "Brun saus (pose eller hjemmelaget)", "Ertestuing", "Tyttebær"], steps: ["Kok poteter.", "Form og stek kjøttkaker. La trekke i saus.", "Lag ertestuing."] }, lunchKid: { title: "Fruktbeger", image: "https://images.unsplash.com/photo-1565557623262-b51c2513a641?q=80&w=800", desc: "Oppkuttet frukt.", servings: 1, time: "5 min", ingredients: ["Eple", "Pære", "Druer"], steps: ["Kutt opp."] }, lunchAdult: { title: "Chili-lunsj", image: "https://images.unsplash.com/photo-1526318896980-cf78c088247c?q=80&w=800", desc: "Varmer godt.", servings: 1, time: "2 min", ingredients: ["Chili Sin Carne"], steps: ["Varm opp."] } } },
            { day: "Torsdag", theme: "Suppe", lunchKid: "Kjøttkake på gaffel", lunchAdult: "Kjøttkake-smørbrød", dinner: "Røde linser & Gulrotsuppe", iconName: "chef-hat", color: "text-orange-500", image: "https://images.unsplash.com/photo-1547592180-85f173990554?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Gulrot & Linsesuppe", image: "https://images.unsplash.com/photo-1547592180-85f173990554?q=80&w=800&auto=format&fit=crop", desc: "Billig, sunt og godt.", servings: 4, time: "25 min", timers: [{ label: "Koke suppe", minutes: 20 }], nutrition: { calories: "300", protein: "12g", fat: "8g", carbs: "40g" }, ingredients: ["500g Gulrøtter", "2dl Røde Linser", "Løk", "Ingefær", "Kraft", "Appelsinjuice (litt)"], steps: ["Fres løk, ingefær og gulrot.", "Ha i linser og kraft. Kok mørt.", "Kjør glatt. Smak til med litt juice."] }, lunchKid: { title: "Kjøttkake-gaffel", image: "https://images.unsplash.com/photo-1555939594-58d7cb561ad1?q=80&w=800", desc: "Kald kjøttkake er snacks.", servings: 1, time: "0 min", ingredients: ["Kjøttkake"], steps: ["Pakk ned."] }, lunchAdult: { title: "Smørbrød", image: "https://images.unsplash.com/photo-1555939594-58d7cb561ad1?q=80&w=800", desc: "Med rødbeter.", servings: 1, time: "2 min", ingredients: ["Brød", "Kjøttkake", "Rødbeter"], steps: ["Lag smørbrød."] } } },
            { day: "Fredag", theme: "Tex-Mex", lunchKid: "Suppe-rester", lunchAdult: "Suppe-rester", dinner: "Kylling Enchiladas", iconName: "smile", color: "text-yellow-600", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Kylling Enchiladas", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800&auto=format&fit=crop", desc: "Gratinerte wraps i ovn.", servings: 4, time: "35 min", timers: [{ label: "Gratinere", minutes: 15 }], nutrition: { calories: "600", protein: "35g", fat: "25g", carbs: "50g" }, ingredients: ["Tortillas", "Kylling", "Mais", "Salsa", "Rømme", "Ost"], steps: ["Stek kylling og bland med salsa og mais.", "Fyll lefser, rull sammen og legg i form.", "Strø over ost. Stek på 200 grader til osten er gyllen."] }, lunchKid: { title: "Suppe", image: "https://images.unsplash.com/photo-1547592180-85f173990554?q=80&w=800", desc: "På termos.", servings: 1, time: "2 min", ingredients: ["Suppe"], steps: ["Varm."] }, lunchAdult: { title: "Suppe", image: "https://images.unsplash.com/photo-1547592180-85f173990554?q=80&w=800", desc: "Lunsj.", servings: 1, time: "2 min", ingredients: ["Suppe"], steps: ["Varm."] } } }
        ];

        const shoppingListWeek1 = {
            "Frukt & Grønt": ["Kiwi", "Pasjonsfrukt", "Agurk (1)", "Paprika (2)", "Spinat", "Cherrytomater", "Søtpotet (2)", "Gulrøtter", "Brokkoli", "Ruccola", "Avokado", "Rødkål", "Løk & Hvitløk", "Ingefær", "Chili"],
            "Kjøl & Meieri": ["Røkelaks", "Makrell i tomat", "Leverpostei", "Brunost", "Snøfrisk", "Fetaost", "Egg (12)", "Melk", "Yoghurt", "Rømme", "Smør"],
            "Tørrvarer": ["Hakkede tomater (4)", "Kikerter", "Kokosmelk", "Mais", "Røde linser", "Quinoa", "Ris", "Pasta", "Havregryn", "Brød", "Lefser", "Nanbrød", "Nøtter", "Pesto", "Buljong"],
            "Fisk & Kjøtt": ["Laksefileter (4)", "Torskefilet", "Kyllingfilet"]
        };

        const shoppingListWeek2 = {
            "Frukt & Grønt": ["Kiwi", "Pasjonsfrukt", "Løk & Hvitløk", "Ingefær (fersk)", "Spinat", "Tomater (4-5)", "Agurk", "Avokado (2)", "Mango (2)", "Poteter", "Gulrot", "Stangselleri", "Fersk Basilikum", "Sitron & Lime"],
            "Kjøl & Meieri": ["Mozzarella (1)", "Halloumi (1 pk)", "Tzatziki (eller yoghurt)", "Egg (12)", "Melk", "Ost (revet)", "Skinke", "Smør"],
            "Tørrvarer": ["Kikerter (2 bokser)", "Kokosmelk (1 boks)", "Soyasaus", "Sesamfrø", "Honning", "Hvite bønner (1 boks)", "Ris/Nudler", "Pita/Lefser", "Tortillas (små)", "Tunfisk (boks)", "Granola", "Pasta", "Pesto", "Knekkebrød"],
            "Fisk & Kjøtt": ["Laksefileter (4)", "Kyllingfilet (400g)", "Fiskekaker"]
        };

        const shoppingListWeek3 = { "Frukt & Grønt": ["Poteter (10-15)", "Gulrøtter (1 kg)", "Eple (2)", "Løk (3)", "Wok-blanding", "Blomkål (2)", "Spinat", "Ruccola", "Banan"], "Kjøl & Meieri": ["Fiskekaker (800g)", "Rømme", "Fløte/Melk (2dl)", "Ost (revet)", "Mozzarella", "Spekeskinke (1 pk)", "Egg (6)", "Smør", "Yoghurt"], "Tørrvarer": ["Lasagneplater", "Hakkede tomater (3 bokser)", "Røde linser", "Nudler", "Soyasaus", "Fullkornsmel", "Gjær", "Tomatsaus (pizza)", "Knekkebrød", "Musli"], "Fisk & Kjøtt": ["Kyllingfilet (400g)", "Bacon"] };
        const shoppingListWeek4 = { "Frukt & Grønt": ["Cherrytomater", "Løk & Hvitløk (mye)", "Chili", "Paprika (2)", "Poteter", "Gulrøtter (500g)", "Ingefær", "Mais (2 bokser)", "Appelsin", "Eple/Pære/Druer"], "Kjøl & Meieri": ["Fløte (3dl)", "Rømme", "Ost (revet)", "Brunost?", "Melk"], "Tørrvarer": ["Grønn pesto", "Ris", "Kidneybønner (2 bokser)", "Hakkede tomater (1 boks)", "Mørk sjokolade", "Brun saus pose", "Ertestuing (boks)", "Røde linser", "Salsa", "Tortillas"], "Fisk & Kjøtt": ["Torskefilet (600g)", "Kjøttdeig (400g)", "Kylling (400g)"] };

        const App = () => {
            const [activeTab, setActiveTab] = useState('menu');
            const [currentWeek, setCurrentWeek] = useState(1);
            const [checkedItems, setCheckedItems] = useState({});
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            
            // Recipe & App States - MED PERSISTENCE
            const [currentRecipe, setCurrentRecipe] = useState(() => {
                try {
                    const saved = localStorage.getItem('familienBro-activeRecipe');
                    return saved ? JSON.parse(saved) : null;
                } catch { return null; }
            });
            
            const [recipeServings, setRecipeServings] = useState(4);
            const [completedSteps, setCompletedSteps] = useState(new Set());
            const [ratings, setRatings] = useState({});
            
            // Search States
            const [searchTags, setSearchTags] = useState([]);
            const [searchInputValue, setSearchInputValue] = useState("");
            const [searchMode, setSearchMode] = useState('OR'); 
            
            // Multiple Timers State - MED PERSISTENCE
            const [activeTimers, setActiveTimers] = useState(() => {
                try {
                    const saved = localStorage.getItem('familienBro-timers');
                    return saved ? JSON.parse(saved) : [];
                } catch { return []; }
            });

            // History handling (Browser Back Button)
            useEffect(() => {
                // Initial replace to ensure valid state
                if (!window.history.state) {
                    window.history.replaceState({ tab: 'menu' }, '', window.location.pathname);
                }

                const handlePopState = (event) => {
                    if (event.state && event.state.tab) {
                        setActiveTab(event.state.tab);
                        if (event.state.recipe) {
                            setCurrentRecipe(event.state.recipe);
                        }
                    } else {
                        // Fallback til meny hvis ingen state (f.eks. ved reload/første load)
                        setActiveTab('menu');
                    }
                };

                window.addEventListener('popstate', handlePopState);
                return () => window.removeEventListener('popstate', handlePopState);
            }, []);

            // Helper to navigate and push history
            const navigateToTab = (tab, recipe = null) => {
                setActiveTab(tab);
                if (recipe) setCurrentRecipe(recipe);
                
                // Optional: Update URL hash
                const hash = recipe ? '#oppskrift' : (tab === 'menu' ? '#' : `#${tab}`);
                window.history.pushState({ tab, recipe }, '', hash);
                
                if (tab === 'recipe') window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            // Lagre currentRecipe når den endres
            useEffect(() => {
                if (currentRecipe) {
                    localStorage.setItem('familienBro-activeRecipe', JSON.stringify(currentRecipe));
                }
            }, [currentRecipe]);

            const allRecipes = useMemo(() => {
                const recipes = [];
                const add = (rec, type, day, week) => { if(rec) recipes.push({...rec, type, day, week}); };
                const processWeek = (data, w) => data.forEach(d => {
                    add(d.recipes.dinner, 'Middag', d.day, w);
                    add(d.recipes.lunchKid, 'Lunsj (Barn)', d.day, w);
                    add(d.recipes.lunchAdult, 'Lunsj (Voksen)', d.day, w);
                });
                processWeek(week1Data, 1);
                processWeek(week2Data, 2);
                processWeek(week3Data, 3);
                processWeek(week4Data, 4);
                return recipes;
            }, []);

            useEffect(() => {
                try {
                    const savedList = localStorage.getItem(`familienBro-handleliste-uke${currentWeek}`);
                    if (savedList) setCheckedItems(JSON.parse(savedList));
                    const savedRatings = localStorage.getItem('familienBro-ratings');
                    if (savedRatings) setRatings(JSON.parse(savedRatings));
                } catch (e) { console.error(e); }
            }, [currentWeek]);

            let activeMenuData, activeShoppingList;
            if (currentWeek === 1) { activeMenuData = week1Data; activeShoppingList = shoppingListWeek1; }
            else if (currentWeek === 2) { activeMenuData = week2Data; activeShoppingList = shoppingListWeek2; }
            else if (currentWeek === 3) { activeMenuData = week3Data; activeShoppingList = shoppingListWeek3; }
            else { activeMenuData = week4Data; activeShoppingList = shoppingListWeek4; }

            const filteredAllRecipes = allRecipes.filter(r => {
                if (searchTags.length === 0 && !searchInputValue) return true;
                const terms = [...searchTags];
                if (searchInputValue.trim()) terms.push(searchInputValue.trim());
                const checkTerm = (term) => {
                    const q = term.toLowerCase();
                    return r.title.toLowerCase().includes(q) || r.ingredients.some(i => i.toLowerCase().includes(q));
                };
                return searchMode === 'OR' ? terms.some(checkTerm) : terms.every(checkTerm);
            });

            const toggleItem = (key) => {
                const newState = { ...checkedItems, [key]: !checkedItems[key] };
                setCheckedItems(newState);
                localStorage.setItem(`familienBro-handleliste-uke${currentWeek}`, JSON.stringify(newState));
            };

            const resetList = () => {
                if(confirm('Vil du nullstille listen for denne uken?')) {
                    setCheckedItems({});
                    localStorage.removeItem(`familienBro-handleliste-uke${currentWeek}`);
                }
            };

            const handleRecipeClick = (e, recipe) => {
                if (e) e.stopPropagation(); 
                if (recipe) {
                    setRecipeServings(recipe.servings);
                    setCompletedSteps(new Set());
                    // Use navigation helper for history support
                    navigateToTab('recipe', recipe);
                }
            };

            const handleRating = (stars) => {
                if (!currentRecipe) return;
                const newRatings = { ...ratings, [currentRecipe.title]: stars };
                setRatings(newRatings);
                localStorage.setItem('familienBro-ratings', JSON.stringify(newRatings));
            };

            const toggleStep = (index) => {
                const newSet = new Set(completedSteps);
                if (newSet.has(index)) newSet.delete(index);
                else newSet.add(index);
                setCompletedSteps(newSet);
            };

            const getScaledIngredient = (ing) => {
                const match = ing.match(/^([\d.,]+)/);
                if (match && currentRecipe) {
                    const originalVal = parseFloat(match[0].replace(',', '.'));
                    if (!isNaN(originalVal)) {
                        const scaledVal = (originalVal / currentRecipe.servings) * recipeServings;
                        const formatted = Number.isInteger(scaledVal) ? scaledVal : scaledVal.toFixed(1);
                        return ing.replace(match[0], formatted);
                    }
                }
                return ing;
            };

            const addTimer = (minutes, label) => {
                playStartSound();
                const newTimer = {
                    id: Date.now(),
                    label: label || "Timer",
                    timeRemaining: minutes * 60,
                    active: true,
                    finished: false,
                    acknowledged: false
                };
                setActiveTimers(prev => {
                    const updated = [...prev, newTimer];
                    localStorage.setItem('familienBro-timers', JSON.stringify(updated));
                    return updated;
                });
            };

            return (
                <div className="min-h-screen flex flex-col pb-20">
                    <header className="bg-lime-900 text-white shadow-lg sticky top-0 z-40 no-print">
                        <div className="max-w-4xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => navigateToTab('menu')}>
                                <Icon name="leaf" className="w-6 h-6 text-lime-300" />
                                <h1 className="text-xl font-bold tracking-tight hidden sm:block">Familien Bro</h1>
                            </div>
                            
                            {activeTab === 'menu' && (
                                <div className="flex bg-lime-950/50 rounded-lg p-1 mx-2 overflow-x-auto">
                                    {[1, 2, 3, 4].map(w => (
                                        <button key={w} onClick={() => setCurrentWeek(w)} className={`px-2.5 py-1 text-xs font-bold rounded-md transition-all whitespace-nowrap ${currentWeek === w ? 'bg-white text-lime-900 shadow' : 'text-lime-200 hover:text-white'}`}>Uke {w}</button>
                                    ))}
                                </div>
                            )}

                            <nav className="hidden md:flex gap-1 bg-lime-950/30 p-1 rounded-lg">
                                {['menu', 'all_recipes', 'shopping', 'recipe'].map((tab) => (
                                    <button
                                        key={tab}
                                        onClick={() => navigateToTab(tab)}
                                        className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${activeTab === tab ? 'bg-white text-lime-900 shadow-sm' : 'text-lime-100 hover:bg-lime-800'}`}
                                    >
                                        {tab === 'menu' && 'Meny'}
                                        {tab === 'all_recipes' && 'Oppskrifter'}
                                        {tab === 'shopping' && 'Liste'}
                                        {tab === 'recipe' && 'Aktiv oppskrift'}
                                    </button>
                                ))}
                                <a href="trening.html" className="px-4 py-1.5 rounded-md text-sm font-medium transition-all text-lime-100 hover:bg-lime-800 flex items-center gap-1">Trening</a>
                            </nav>

                            <button className="md:hidden p-2" onClick={() => setMobileMenuOpen(!mobileMenuOpen)}>
                                <Icon name={mobileMenuOpen ? "x" : "menu"} className="w-6 h-6" />
                            </button>
                        </div>

                        {mobileMenuOpen && (
                            <div className="md:hidden bg-lime-900 border-t border-lime-700">
                                <div className="flex flex-col p-2 space-y-1">
                                    {['menu', 'all_recipes', 'shopping', 'recipe'].map((tab) => (
                                        <button key={tab} onClick={() => { navigateToTab(tab); setMobileMenuOpen(false); }} className={`px-4 py-3 rounded-md text-left font-medium ${activeTab === tab ? 'bg-lime-800 text-white' : 'text-lime-100'}`}>
                                            {tab === 'menu' && '📅 Ukesmeny'}
                                            {tab === 'all_recipes' && '🍲 Alle Oppskrifter'}
                                            {tab === 'shopping' && '🛒 Handleliste'}
                                            {tab === 'recipe' && '🍳 Aktiv oppskrift'}
                                        </button>
                                    ))}
                                    <a href="trening.html" className="px-4 py-3 rounded-md text-left font-medium text-lime-100 hover:bg-lime-800">💪 Trening</a>
                                </div>
                            </div>
                        )}
                    </header>

                    <main className="max-w-4xl mx-auto px-4 py-6 md:py-10 w-full flex-grow">
                        
                        <FloatingTimerList activeTimers={activeTimers} setActiveTimers={setActiveTimers} />

                        {activeTab === 'menu' && (
                            <div className="space-y-6 animate-fade-in">
                                <div className="text-center mb-8">
                                    <h2 className="text-3xl font-bold text-stone-800 mb-2">Ukesmeny - Uke {currentWeek}</h2>
                                    <p className="text-stone-600">Trykk på middag eller lunsj for å se oppskriften</p>
                                </div>

                                <div className="grid gap-6 md:grid-cols-1">
                                    {activeMenuData.map((day, idx) => (
                                        <div 
                                            key={idx} 
                                            onClick={(e) => handleRecipeClick(e, day.recipes.dinner)}
                                            className="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden flex flex-col md:flex-row hover:shadow-lg transition-all cursor-pointer clickable-card group"
                                        >
                                            <div className="h-48 md:w-48 md:h-auto relative bg-stone-200 shrink-0">
                                                <img src={day.image} alt={day.dinner} className="w-full h-full object-cover transition-transform group-hover:scale-105 duration-500" />
                                                <div className="absolute top-0 left-0 bg-sky-700 text-white px-3 py-1 text-sm font-bold rounded-br-lg">
                                                    {day.day}
                                                </div>
                                            </div>
                                            <div className="p-6 flex-1 flex flex-col justify-center">
                                                <div className="flex items-center justify-between mb-3">
                                                    <div className="flex items-center gap-2">
                                                        <Icon name={day.iconName} className={`w-5 h-5 ${day.color}`} />
                                                        <span className="text-xs font-semibold uppercase tracking-wider text-stone-500 border border-stone-200 px-2 py-0.5 rounded-full">
                                                            {day.theme}
                                                        </span>
                                                    </div>
                                                    <div className="text-lime-700 opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1 text-xs font-medium">
                                                        Se middag <Icon name="chevron-right" className="w-4 h-4" />
                                                    </div>
                                                </div>
                                                <div className="space-y-3">
                                                    <div>
                                                        <h3 className="text-lg font-bold text-stone-800 leading-tight mb-1 group-hover:text-lime-800 transition-colors">{day.dinner}</h3>
                                                        <p className="text-sm text-stone-500 flex items-center gap-1"><Icon name="utensils-crossed" className="w-3 h-3" /> Middag</p>
                                                    </div>
                                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 pt-3 border-t border-stone-100">
                                                        <div 
                                                            onClick={(e) => handleRecipeClick(e, day.recipes.lunchKid)}
                                                            className={`p-2 rounded-lg transition-colors border border-transparent ${day.recipes.lunchKid ? 'bg-orange-50 hover:bg-orange-100 hover:border-orange-200 cursor-pointer lunch-card' : 'bg-stone-50'}`}
                                                        >
                                                            <div className="flex justify-between items-start">
                                                                <p className="text-xs font-bold text-orange-800 uppercase mb-0.5">Lunsj Barn</p>
                                                                {day.recipes.lunchKid && <Icon name="arrow-up-right" className="w-3 h-3 text-orange-400" />}
                                                            </div>
                                                            <p className="text-sm text-stone-700 leading-snug">{day.lunchKid}</p>
                                                        </div>

                                                        <div 
                                                            onClick={(e) => handleRecipeClick(e, day.recipes.lunchAdult)}
                                                            className={`p-2 rounded-lg transition-colors border border-transparent ${day.recipes.lunchAdult ? 'bg-sky-50 hover:bg-sky-100 hover:border-sky-200 cursor-pointer lunch-card' : 'bg-stone-50 opacity-70'}`}
                                                        >
                                                            <div className="flex justify-between items-start">
                                                                <p className="text-xs font-bold text-sky-800 uppercase mb-0.5">Lunsj Voksen</p>
                                                                {day.recipes.lunchAdult && <Icon name="arrow-up-right" className="w-3 h-3 text-sky-400" />}
                                                            </div>
                                                            <p className="text-sm text-stone-700 leading-snug">{day.lunchAdult}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'all_recipes' && (
                            <div className="animate-fade-in">
                                <div className="text-center mb-8">
                                    <h2 className="text-3xl font-bold text-stone-800 mb-4">Alle Oppskrifter</h2>
                                    
                                    {/* TAG SØK / TØM KJØLESKAPET */}
                                    <div className="max-w-md mx-auto relative mb-6">
                                        <div className="flex justify-center gap-2 mb-3">
                                            <button 
                                                onClick={() => setSearchMode('OR')}
                                                className={`px-3 py-1 text-xs font-bold rounded-full transition-all border ${searchMode === 'OR' ? 'bg-lime-600 text-white border-lime-600 shadow-sm' : 'bg-white text-stone-500 border-stone-200 hover:bg-stone-50'}`}
                                            >
                                                Minst én ingrediens
                                            </button>
                                            <button 
                                                onClick={() => setSearchMode('AND')}
                                                className={`px-3 py-1 text-xs font-bold rounded-full transition-all border ${searchMode === 'AND' ? 'bg-lime-600 text-white border-lime-600 shadow-sm' : 'bg-white text-stone-500 border-stone-200 hover:bg-stone-50'}`}
                                            >
                                                Alle ingredienser
                                            </button>
                                        </div>

                                        <TagSearchInput 
                                            tags={searchTags} 
                                            setTags={setSearchTags}
                                            inputValue={searchInputValue}
                                            setInputValue={setSearchInputValue}
                                            placeholder="Tøm kjøleskapet (skriv ingrediens, trykk enter...)"
                                        />
                                        <p className="text-xs text-stone-400 mt-2 text-center">
                                            {searchMode === 'OR' 
                                                ? "Viser oppskrifter som inneholder noen av ingrediensene." 
                                                : "Viser kun oppskrifter som inneholder ALT du har skrevet inn."}
                                        </p>
                                    </div>
                                </div>

                                <div className="grid gap-6 grid-cols-1 md:grid-cols-2">
                                    {filteredAllRecipes.length === 0 && (
                                        <div className="text-center py-10 text-stone-500 col-span-full">
                                            Ingen oppskrifter funnet med disse ingrediensene 🥬
                                        </div>
                                    )}
                                    {filteredAllRecipes.map((recipe, idx) => (
                                        <div 
                                            key={idx} 
                                            onClick={() => handleRecipeClick(null, recipe)}
                                            className="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden hover:shadow-lg transition-all cursor-pointer flex flex-col"
                                        >
                                            <div className="h-40 relative bg-stone-200">
                                                <img src={recipe.image} alt={recipe.title} className="w-full h-full object-cover" />
                                                <div className="absolute top-2 right-2 bg-white/90 backdrop-blur px-2 py-1 rounded text-xs font-bold text-stone-700">
                                                    Uke {recipe.week} • {recipe.day}
                                                </div>
                                            </div>
                                            <div className="p-4 flex-grow flex flex-col justify-between">
                                                <div>
                                                    <span className="text-xs font-bold text-lime-600 uppercase mb-1 block">{recipe.type}</span>
                                                    <h3 className="font-bold text-stone-800 text-lg leading-tight mb-2">{recipe.title}</h3>
                                                    <p className="text-sm text-stone-500 line-clamp-2">{recipe.desc}</p>
                                                </div>
                                                <div className="mt-4 flex items-center gap-4 text-xs text-stone-400">
                                                    <div className="flex items-center gap-1"><Icon name="clock" className="w-3 h-3" /> {recipe.time}</div>
                                                    {ratings[recipe.title] && (
                                                        <div className="flex items-center gap-1 text-yellow-500"><Icon name="star" className="w-3 h-3 fill-current" /> {ratings[recipe.title]}</div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'shopping' && (
                            <div className="max-w-2xl mx-auto animate-fade-in">
                                <div className="flex items-center justify-between mb-6 no-print">
                                    <h2 className="text-3xl font-bold text-stone-800">Handleliste (Uke {currentWeek})</h2>
                                    <div className="flex gap-3">
                                        <button onClick={() => window.print()} className="text-sm text-lime-700 hover:text-lime-900 font-medium flex items-center gap-1">
                                            <Icon name="printer" className="w-4 h-4 inline" /> Skriv ut
                                        </button>
                                        <button onClick={resetList} className="text-sm text-lime-700 hover:text-lime-900 font-medium">
                                            Nullstill
                                        </button>
                                    </div>
                                </div>

                                <div className="grid gap-6">
                                    {Object.entries(activeShoppingList).map(([category, items]) => (
                                        <div key={category} className="bg-white rounded-xl shadow-sm border border-stone-200 p-6 break-inside-avoid">
                                            <h3 className="text-lg font-bold text-lime-800 border-b border-lime-100 pb-2 mb-4">
                                                {category}
                                            </h3>
                                            <div className="space-y-3">
                                                {items.map((item, idx) => {
                                                    const key = `${category}-${idx}`;
                                                    const isChecked = checkedItems[key];
                                                    return (
                                                        <div 
                                                            key={key} 
                                                            onClick={() => toggleItem(key)}
                                                            className="flex items-start gap-3 cursor-pointer group select-none"
                                                        >
                                                            <div className={`mt-0.5 shrink-0 transition-colors ${isChecked ? 'text-lime-600' : 'text-stone-300 group-hover:text-lime-400'}`}>
                                                                <Icon name={isChecked ? "check-circle-2" : "circle"} className="w-5 h-5" />
                                                            </div>
                                                            <span className={`text-base transition-all ${isChecked ? 'text-stone-400 line-through decoration-stone-300' : 'text-stone-700'}`}>
                                                                {item}
                                                            </span>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'recipe' && (
                            currentRecipe ? (
                                <div className="max-w-2xl mx-auto bg-white rounded-2xl shadow-lg border border-stone-100 overflow-hidden animate-fade-in">
                                    <div className="h-64 relative bg-stone-800">
                                        <img src={currentRecipe.image} alt={currentRecipe.title} className="w-full h-full object-cover opacity-90" />
                                        <div className="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent flex items-end">
                                            <div className="p-8 text-white w-full">
                                                <div className="flex justify-between items-end">
                                                    <div>
                                                        <h2 className="text-3xl font-bold mb-2">{currentRecipe.title}</h2>
                                                        <p className="text-lg text-lime-200">{currentRecipe.desc}</p>
                                                    </div>
                                                    
                                                    <div className="flex flex-col items-end">
                                                        <div className="flex gap-1">
                                                            {[1,2,3,4,5].map(star => (
                                                                <button 
                                                                    key={star} 
                                                                    onClick={(e) => {e.stopPropagation(); handleRating(star)}}
                                                                    className={`transition-transform hover:scale-125 ${ratings[currentRecipe.title] >= star ? 'text-yellow-400 fill-yellow-400' : 'text-white/50'}`}
                                                                >
                                                                    <Icon name="star" className="w-6 h-6" />
                                                                </button>
                                                            ))}
                                                        </div>
                                                        <span className="text-xs text-lime-100 mt-1 uppercase tracking-widest">Matdommer</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="p-8">
                                        <div className="flex flex-wrap items-center justify-between gap-6 mb-6 text-sm text-stone-500 border-b border-stone-100 pb-6">
                                            <div className="flex gap-6">
                                                <div className="flex items-center gap-2"><Icon name="chef-hat" className="text-lime-600 w-5 h-5" /><span>Enkel</span></div>
                                                <div className="flex items-center gap-2"><Icon name="clock" className="text-lime-600 w-5 h-5" /><span>{currentRecipe.time}</span></div>
                                            </div>
                                            <div className="flex flex-wrap gap-2">
                                                {currentRecipe.timers && currentRecipe.timers.map((timer, i) => (
                                                    <button 
                                                        key={i}
                                                        onClick={() => addTimer(timer.minutes, timer.label)}
                                                        className="flex items-center gap-2 bg-stone-100 hover:bg-stone-200 px-3 py-1.5 rounded-full text-stone-700 transition-colors font-medium text-xs"
                                                    >
                                                        <Icon name="timer" className="w-4 h-4" /> {timer.label} ({timer.minutes} min)
                                                    </button>
                                                ))}
                                                {(!currentRecipe.timers || currentRecipe.timers.length === 0) && (
                                                    <button 
                                                        onClick={() => addTimer(10, "Timer")}
                                                        className="flex items-center gap-2 bg-stone-100 hover:bg-stone-200 px-3 py-1.5 rounded-full text-stone-700 transition-colors font-medium text-xs"
                                                    >
                                                        <Icon name="timer" className="w-4 h-4" /> Start timer (10 min)
                                                    </button>
                                                )}
                                            </div>
                                        </div>

                                        {currentRecipe.nutrition && (
                                            <div className="bg-orange-50 rounded-xl p-4 mb-8 border border-orange-100">
                                                <h4 className="text-xs font-bold text-orange-800 uppercase tracking-wider mb-3">Næringsinnhold pr. porsjon (ca.)</h4>
                                                <div className="grid grid-cols-4 gap-2 text-center">
                                                    <div className="bg-white p-2 rounded-lg shadow-sm">
                                                        <div className="text-lg font-bold text-stone-800">{currentRecipe.nutrition.calories}</div>
                                                        <div className="text-[10px] text-stone-500 uppercase">kcal</div>
                                                    </div>
                                                    <div className="bg-white p-2 rounded-lg shadow-sm">
                                                        <div className="text-lg font-bold text-stone-800">{currentRecipe.nutrition.protein}</div>
                                                        <div className="text-[10px] text-stone-500 uppercase">Protein</div>
                                                    </div>
                                                    <div className="bg-white p-2 rounded-lg shadow-sm">
                                                        <div className="text-lg font-bold text-stone-800">{currentRecipe.nutrition.fat}</div>
                                                        <div className="text-[10px] text-stone-500 uppercase">Fett</div>
                                                    </div>
                                                    <div className="bg-white p-2 rounded-lg shadow-sm">
                                                        <div className="text-lg font-bold text-stone-800">{currentRecipe.nutrition.carbs}</div>
                                                        <div className="text-[10px] text-stone-500 uppercase">Karb.</div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        <div className="grid md:grid-cols-2 gap-10">
                                            <div>
                                                <div className="flex items-center justify-between mb-4">
                                                    <h3 className="font-bold text-stone-800 text-lg flex items-center gap-2">
                                                        <span className="bg-lime-100 text-lime-800 w-6 h-6 rounded-full flex items-center justify-center text-xs">1</span>
                                                        Ingredienser
                                                    </h3>
                                                    <div className="flex items-center gap-3 bg-stone-100 px-3 py-1 rounded-full">
                                                        <button onClick={() => setRecipeServings(Math.max(1, recipeServings - 1))} className="text-stone-500 hover:text-stone-800"><Icon name="minus" className="w-4 h-4" /></button>
                                                        <span className="text-sm font-bold text-stone-800 w-4 text-center">{recipeServings}</span>
                                                        <button onClick={() => setRecipeServings(recipeServings + 1)} className="text-stone-500 hover:text-stone-800"><Icon name="plus" className="w-4 h-4" /></button>
                                                        <span className="text-xs text-stone-500 ml-1">porsjoner</span>
                                                    </div>
                                                </div>
                                                <ul className="space-y-2 text-stone-700">
                                                    {currentRecipe.ingredients.map((ing, i) => (
                                                        <li key={i} className="flex items-start gap-2 p-2 rounded-lg hover:bg-stone-50 transition-colors">
                                                            <span className="w-1.5 h-1.5 bg-lime-400 rounded-full mt-2 shrink-0"></span>
                                                            <span>{getScaledIngredient(ing)}</span>
                                                        </li>
                                                    ))}
                                                </ul>
                                            </div>

                                            <div>
                                                <h3 className="font-bold text-stone-800 text-lg mb-4 flex items-center gap-2">
                                                    <span className="bg-lime-100 text-lime-800 w-6 h-6 rounded-full flex items-center justify-center text-xs">2</span>
                                                    Fremgangsmåte
                                                </h3>
                                                <ol className="space-y-4">
                                                    {currentRecipe.steps.map((step, i) => (
                                                        <li 
                                                            key={i} 
                                                            onClick={() => toggleStep(i)}
                                                            className={`flex gap-4 p-3 rounded-xl cursor-pointer transition-all border ${completedSteps.has(i) ? 'bg-stone-50 border-stone-200 step-checked' : 'bg-white border-transparent hover:border-lime-100 hover:shadow-sm'}`}
                                                        >
                                                            <div className={`mt-0.5 shrink-0 ${completedSteps.has(i) ? 'text-lime-500' : 'text-lime-700'}`}>
                                                                {completedSteps.has(i) ? <Icon name="check-circle-2" className="w-6 h-6" /> : <span className="font-bold text-lg font-mono">{i + 1}.</span>}
                                                            </div>
                                                            <p>{step}</p>
                                                        </li>
                                                    ))}
                                                </ol>
                                            </div>
                                        </div>
                                        
                                        <div className="mt-8 bg-sky-50 p-4 rounded-lg border border-sky-100">
                                            <h4 className="font-bold text-sky-800 mb-1 text-sm">💡 Tips fra Familien Bro</h4>
                                            <p className="text-sky-700 text-sm">
                                                Trykk på stegene over når du er ferdig med dem for å holde oversikten!
                                            </p>
                                        </div>

                                        <div className="mt-6 pt-6 border-t border-stone-100 text-center md:hidden">
                                            <button 
                                                onClick={() => navigateToTab('menu')}
                                                className="text-lime-700 font-medium hover:text-lime-900 text-sm flex items-center justify-center gap-2 w-full p-2"
                                            >
                                                <Icon name="arrow-left" className="w-4 h-4" /> Tilbake til menyen
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div className="text-center py-20 animate-fade-in">
                                    <div className="inline-block p-4 bg-stone-100 rounded-full mb-4">
                                        <Icon name="chef-hat" className="w-12 h-12 text-stone-400" />
                                    </div>
                                    <h2 className="text-2xl font-bold text-stone-800 mb-2">Ingen aktiv oppskrift</h2>
                                    <p className="text-stone-500 mb-6">Velg en rett fra ukesmenyen eller søk opp en oppskrift for å se den her.</p>
                                    <button 
                                        onClick={() => navigateToTab('menu')}
                                        className="bg-lime-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-lime-700 transition-colors"
                                    >
                                        Gå til Meny
                                    </button>
                                </div>
                            )
                        )}
                    </main>

                    <footer className="bg-stone-800 text-stone-400 py-8 mt-12 text-center text-sm no-print">
                        <p>Familien Bro - Ukesmeny</p>
                        <p className="mt-1">Basert på middelhavsdietten 🌱</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>