<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Familien Bro - Ukesmeny</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #fafaf9; color: #44403c; }
        
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            .print-only { display: block !important; }
        }
        
        .clickable-card:active { transform: scale(0.98); }
        .lunch-card:hover { filter: brightness(0.95); }
        
        .step-checked {
            text-decoration: line-through;
            color: #a8a29e;
            transition: all 0.3s ease;
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .timer-finished {
            animation: pulse-red 2s infinite;
            background-color: #7f1d1d;
            border-color: #ef4444;
        }
    </style>
</head>
<body>
    
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- LYDEFFEKT (Rolig alarm) ---
        const playCalmAlarm = () => {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const now = ctx.currentTime;
            const notes = [261.63, 329.63, 392.00]; 
            notes.forEach((freq, i) => {
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, now + (i * 0.2));
                gain.gain.setValueAtTime(0, now + (i * 0.2));
                gain.gain.linearRampToValueAtTime(0.3, now + (i * 0.2) + 0.1);
                gain.gain.exponentialRampToValueAtTime(0.01, now + (i * 0.2) + 1.5);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start(now + (i * 0.2));
                osc.stop(now + (i * 0.2) + 2);
            });
        };

        // --- LYDEFFEKT (Start Timer) ---
        const playStartSound = () => {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.setValueAtTime(440, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
            osc.start();
            osc.stop(ctx.currentTime + 0.1);
        };

        const Icon = ({ name, className }) => {
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [name]); 
            return <i data-lucide={name} className={className}></i>;
        };

        // --- TAG SEARCH INPUT COMPONENT ---
        const TagSearchInput = ({ tags, setTags, inputValue, setInputValue, placeholder }) => {
            const handleKeyDown = (e) => {
                if (e.key === 'Enter' || e.key === ',') {
                    e.preventDefault();
                    const trimmedInput = inputValue.trim();
                    if (trimmedInput && !tags.includes(trimmedInput)) {
                        setTags([...tags, trimmedInput]);
                        setInputValue('');
                    }
                } else if (e.key === 'Backspace' && !inputValue && tags.length > 0) {
                    setTags(tags.slice(0, -1));
                }
            };
            const removeTag = (tagToRemove) => {
                setTags(tags.filter(tag => tag !== tagToRemove));
            };
            return (
                <div className="flex flex-wrap items-center gap-2 w-full p-2 border border-stone-200 rounded-xl bg-white shadow-sm focus-within:ring-2 focus-within:ring-lime-500 focus-within:border-lime-500">
                    <div className="pl-2 pointer-events-none text-stone-400"><Icon name="search" className="h-5 w-5" /></div>
                    {tags.map((tag, index) => (
                        <span key={index} className="flex items-center gap-1 bg-lime-100 text-lime-800 px-2 py-1 rounded-md text-sm font-medium animate-fade-in">
                            {tag}
                            <button onClick={() => removeTag(tag)} className="hover:bg-lime-200 rounded-full p-0.5 transition-colors"><Icon name="x" className="w-3 h-3" /></button>
                        </span>
                    ))}
                    <input type="text" className="flex-grow min-w-[150px] outline-none text-stone-700 placeholder-stone-400 bg-transparent py-1" placeholder={tags.length === 0 ? placeholder : ""} value={inputValue} onChange={(e) => setInputValue(e.target.value)} onKeyDown={handleKeyDown} />
                </div>
            );
        };

        // --- FLERE TIMERE COMPONENT ---
        const FloatingTimerList = ({ activeTimers, setActiveTimers }) => {
            const alarmIntervalRef = useRef(null);
            const isRinging = activeTimers.some(t => t.finished && !t.acknowledged);

            useEffect(() => {
                const interval = setInterval(() => {
                    setActiveTimers(prevTimers => {
                        const updated = prevTimers.map(timer => {
                            if (!timer.active || timer.finished) return timer;
                            const newTime = timer.timeRemaining - 1;
                            if (newTime <= 0) {
                                return { ...timer, timeRemaining: 0, active: false, finished: true, acknowledged: false };
                            }
                            return { ...timer, timeRemaining: newTime };
                        });
                        localStorage.setItem('familienBro-timers', JSON.stringify(updated));
                        return updated;
                    });
                }, 1000);
                return () => clearInterval(interval);
            }, []);

            useEffect(() => {
                if (isRinging) {
                    if (!alarmIntervalRef.current) {
                        playCalmAlarm();
                        alarmIntervalRef.current = setInterval(() => playCalmAlarm(), 4000);
                    }
                } else {
                    if (alarmIntervalRef.current) {
                        clearInterval(alarmIntervalRef.current);
                        alarmIntervalRef.current = null;
                    }
                }
                return () => { if (alarmIntervalRef.current) clearInterval(alarmIntervalRef.current); };
            }, [isRinging]);

            if (activeTimers.length === 0) return null;

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            };
            const removeTimer = (id) => {
                const newTimers = activeTimers.filter(t => t.id !== id);
                setActiveTimers(newTimers);
                localStorage.setItem('familienBro-timers', JSON.stringify(newTimers));
            };
            const toggleTimer = (id) => {
                const newTimers = activeTimers.map(t => t.id === id ? {...t, active: !t.active} : t);
                setActiveTimers(newTimers);
                localStorage.setItem('familienBro-timers', JSON.stringify(newTimers));
            };
            const acknowledgeAlarm = (id) => {
                const newTimers = activeTimers.map(t => t.id === id ? {...t, acknowledged: true} : t);
                setActiveTimers(newTimers);
                localStorage.setItem('familienBro-timers', JSON.stringify(newTimers));
            };

            return (
                <div className="fixed bottom-4 right-4 flex flex-col gap-2 z-50 animate-fade-in items-end">
                    {activeTimers.map(timer => (
                        <div key={timer.id} className={`text-white p-3 rounded-xl shadow-lg flex items-center gap-3 border border-stone-700 min-w-[240px] justify-between transition-all duration-300 ${timer.finished && !timer.acknowledged ? 'timer-finished scale-105' : 'bg-stone-900'}`}>
                            <div className="flex flex-col overflow-hidden">
                                {timer.recipeTitle && (
                                    <span className="text-[10px] text-lime-300 font-bold truncate w-full mb-0.5">{timer.recipeTitle}</span>
                                )}
                                <span className="text-xs text-stone-300 truncate w-full mb-1" title={timer.label}>{timer.label}</span>
                                <span className="text-xl font-mono font-bold text-white leading-none">{timer.finished ? "Tiden er ute!" : formatTime(timer.timeRemaining)}</span>
                            </div>
                            <div className="flex gap-1 shrink-0 ml-2">
                                {timer.finished && !timer.acknowledged ? (
                                    <button onClick={() => acknowledgeAlarm(timer.id)} className="px-3 py-1.5 bg-red-600 hover:bg-red-500 text-white text-xs font-bold rounded-full animate-pulse">Skru av</button>
                                ) : (
                                    <>
                                        {!timer.finished && (
                                            <button onClick={() => toggleTimer(timer.id)} className="p-1.5 bg-stone-700 rounded-full hover:bg-stone-600"><Icon name={timer.active ? "pause" : "play"} className="w-4 h-4" /></button>
                                        )}
                                        <button onClick={() => removeTimer(timer.id)} className="p-1.5 bg-stone-700 rounded-full hover:bg-red-900/50 hover:text-red-400"><Icon name="x" className="w-4 h-4" /></button>
                                    </>
                                )}
                            </div>
                        </div>
                    ))}
                </div>
            );
        };

        // --- DATA ---
        const week1Data = [
            { 
                day: "Mandag", 
                theme: "Fet fisk & Omega-3", 
                lunchKid: "Fullkornslefse med kalkun & agurk", 
                lunchAdult: "Salat med fetaost, oliven & fullkornspasta", 
                dinner: "Ovnsbakt laks med rotgr√∏nnsaker & tzatziki", 
                iconName: "fish", 
                color: "text-sky-600", 
                image: "https://images.unsplash.com/photo-1485921325833-c519f76c4927?q=80&w=800&auto=format&fit=crop", 
                recipes: { 
                    dinner: { 
                        title: "Ovnsbakt laks & rotgr√∏nt", 
                        image: "https://images.unsplash.com/photo-1485921325833-c519f76c4927?q=80&w=800&auto=format&fit=crop", 
                        desc: "Alt i √©n form - minimalt med oppvask!", 
                        servings: 4, 
                        time: "30 min", 
                        timers: [{ label: "Bak gr√∏nnsaker", minutes: 10 }, { label: "Bak laksen ferdig", minutes: 12 }], 
                        nutrition: { calories: "520", protein: "38g", fat: "28g", carbs: "25g" }, 
                        ingredients: ["4 laksefileter", "2 s√∏tpoteter", "2 gulr√∏tter", "1 brokkoli", "Olivenolje", "Sitronpepper", "Tzatziki eller r√∏mme"], 
                        steps: ["Sett ovnen p√• 200 grader.", "Kutt gr√∏nnsaker i biter og legg i en ildfast form.", "Hell over litt olje og krydder. Bak i 10 min.", "Legg laksestykkene opp√• gr√∏nnsakene.", "Bak videre i ca 12-15 min til laksen er ferdig.", "Server med en klatt tzatziki."] 
                    }, 
                    lunchKid: { 
                        title: "Kalkun-wrap", 
                        image: "https://images.unsplash.com/photo-1626700051175-6818013e1d4f?q=80&w=800&auto=format&fit=crop", 
                        desc: "Enkel og proteinrik lunsj uten fisk.", 
                        servings: 1, 
                        time: "5 min", 
                        nutrition: { calories: "260", protein: "16g", fat: "8g", carbs: "22g" }, 
                        ingredients: ["1 fullkornslefse/tortilla", "1 ss Kremost", "2 skiver Kalkunp√•legg/Skinke", "Agurkstaver"], 
                        steps: ["Sm√∏r lefsen med kremost.", "Legg p√• p√•legg og agurk.", "Rull sammen."] 
                    }, 
                    lunchAdult: { 
                        title: "Middelhavssalat", 
                        image: "https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?q=80&w=800", 
                        desc: "Frisk og mettende salat.", 
                        servings: 1, 
                        time: "10 min", 
                        nutrition: { calories: "450", protein: "15g", fat: "25g", carbs: "40g" }, 
                        ingredients: ["Fullkornspasta (kokt)", "Fetaost", "Oliven", "Agurk", "Tomat", "Olivenolje"], 
                        steps: ["Bland kokt pasta med gr√∏nnsaker og ost.", "Hell over litt god olivenolje."] 
                    } 
                } 
            },
            { day: "Tirsdag", theme: "Kj√∏ttfri & Tarmhelse", lunchKid: "Grovbr√∏d med hummus, paprika & druer", lunchAdult: "Rester av Laks (fra mandag)", dinner: "Kremet linsegryte med kokosmelk & nanbr√∏d", iconName: "leaf", color: "text-lime-700", image: "https://images.unsplash.com/photo-1547592180-85f173990554?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Kremet linsegryte", image: "https://images.unsplash.com/photo-1547592180-85f173990554?q=80&w=800&auto=format&fit=crop", desc: "En varmende gryte full av fiber og gode smaker.", servings: 4, time: "20 min", timers: [{ label: "Koke linser", minutes: 15 }], nutrition: { calories: "410", protein: "19g", fat: "14g", carbs: "48g" }, ingredients: ["2 dl r√∏de linser (t√∏rre)", "1 boks kokosmelk", "1 boks hakkede tomater", "1 l√∏k + 2 fedd hvitl√∏k", "1 pose spinat", "1 ts ingef√¶r", "Nanbr√∏d til servering"], steps: ["Fres hakket l√∏k, hvitl√∏k og ingef√¶r i litt olje.", "Tilsett linser, tomater og kokosmelk. Kok opp.", "La sm√•koke i 15 min til linsene er m√∏re.", "R√∏r inn spinaten helt til slutt s√• den faller sammen.", "Smak til med salt/pepper. Server med nanbr√∏d."] }, lunchKid: { title: "Hummus-skiver & gr√∏nt", image: "https://images.unsplash.com/photo-1621532982823-3b1a26d7f6c3?q=80&w=800&auto=format&fit=crop", desc: "N√¶ringsrik lunsj som holder blodsukkeret stabilt.", servings: 1, time: "5 min", nutrition: { calories: "320", protein: "11g", fat: "13g", carbs: "38g" }, ingredients: ["2 skiver grovbr√∏d", "3 ss hummus (kj√∏pt eller hjemmelaget)", "Paprikastaver", "En liten neve druer"], steps: ["Sm√∏r et godt lag hummus p√• br√∏dskivene.", "Kutt paprika i staver som er lette √• spise.", "Legg ved druer i matboksen."] }, lunchAdult: { title: "Lakse-salat (rester)", image: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?q=80&w=800", desc: "Bruk restene fra mandag!", servings: 1, time: "5 min", nutrition: { calories: "400", protein: "30g", fat: "20g", carbs: "15g" }, ingredients: ["Kald laks", "Ruccola/Spinat", "Agurk", "Dressing"], steps: ["Bland laks og gr√∏nnsaker."] } } },
            { day: "Onsdag", theme: "Kylling & Fullkorn", lunchKid: "Havrelapper med brunost & gulrot", lunchAdult: "Rester av Linsegryte", dinner: "Kyllingpanne med pesto & fullkornspasta", iconName: "utensils-crossed", color: "text-orange-600", image: "https://images.unsplash.com/photo-1473093295043-cdd812d0e601?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Kyllingpanne med pesto", image: "https://images.unsplash.com/photo-1473093295043-cdd812d0e601?q=80&w=800&auto=format&fit=crop", desc: "Rask hverdagsmiddag som barna elsker.", servings: 4, time: "20 min", timers: [{ label: "Koke pasta", minutes: 10 }, { label: "Surre kylling & tomat", minutes: 2 }], nutrition: { calories: "580", protein: "42g", fat: "22g", carbs: "48g" }, ingredients: ["400g kyllingfilet", "300g fullkornspasta", "1 glass gr√∏nn pesto", "1 pk cherrytomater", "Parmesan"], steps: ["Kok pasta.", "Stek kyllingbiter gylne.", "Del tomatene i to og la dem surre med kyllingen.", "Bland ferdig pasta med pesto, kylling og tomater."] }, lunchKid: { title: "Grove havrelapper", image: "https://images.unsplash.com/photo-1575853121743-60c24f0a7502?q=80&w=800&auto=format&fit=crop", desc: "Lag r√∏ren kvelden f√∏r for superrask steking om morgenen.", servings: 1, time: "15 min", nutrition: { calories: "220", protein: "9g", fat: "7g", carbs: "28g" }, ingredients: ["1 egg", "1 dl havregryn", "0.5 dl melk", "0.5 ts bakepulver"], steps: ["Bland ingrediensene og la svelle.", "Stek sm√• lapper i pannen."] }, lunchAdult: { title: "Linsegryte (rester)", image: "https://images.unsplash.com/photo-1547592180-85f173990554?q=80&w=800", desc: "Varm opp i mikroen.", servings: 1, time: "2 min", nutrition: { calories: "410", protein: "19g", fat: "14g", carbs: "48g" }, ingredients: ["Linsegryte", "Nanbr√∏d"], steps: ["Varm opp."] } } },
            { day: "Torsdag", theme: "Suppe & Gurkemeie-boost", lunchKid: "Grovbr√∏d med Makrell i tomat", lunchAdult: "Salat med ruccola, avokado & kikerter", dinner: "Tomatsuppe med Gurkemeie", iconName: "chef-hat", color: "text-red-500", image: "https://images.unsplash.com/photo-1576098762557-4f0165780287?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: 'Tomatsuppe med Gurkemeie', image: "https://images.unsplash.com/photo-1576098762557-4f0165780287?q=80&w=800&auto=format&fit=crop", desc: 'En superhelt-suppe med skjulte linser og anti-inflammatorisk krydder!', servings: 4, time: "25 min", timers: [{ label: "Koke suppe", minutes: 20 }, { label: "Koke egg", minutes: 9 }], nutrition: { calories: "340", protein: "16g", fat: "12g", carbs: "36g" }, ingredients: ["1 ss olivenolje", "1 l√∏k & 2 fedd hvitl√∏k", "2 gulr√∏tter", "1 dl r√∏de linser", "2 bokser hakkede tomater", "1 ts Gurkemeie", "8 dl kraft"], steps: ["Stek l√∏k, hvitl√∏k og gulrot.", "Tilsett gurkemeie og la det frese ett minutt.", "Tilsett tomater, kraft og linser. Kok opp.", "La sm√•koke i 15-20 min.", "Kj√∏r glatt med stavmikser. Server med egg."] }, lunchKid: { title: "Makrell i tomat-skive", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800&auto=format&fit=crop", desc: "Super sunt og godt for hjernen.", servings: 1, time: "3 min", nutrition: { calories: "280", protein: "14g", fat: "15g", carbs: "26g" }, ingredients: ["2 skiver grovbr√∏d", "Makrell i tomat (tube eller boks)", "Agurk"], steps: ["Sm√∏r makrell p√• br√∏det.", "Pynt med agurk."] }, lunchAdult: { title: "Gr√∏nn kikertsalat", image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?q=80&w=800&auto=format&fit=crop", desc: "Enkel, mettende og vegansk.", servings: 1, time: "5 min", nutrition: { calories: "360", protein: "13g", fat: "22g", carbs: "24g" }, ingredients: ["Ruccola", "1/2 avokado", "1/2 boks kikerter", "Gresskarkjerner", "Olivenolje"], steps: ["Bland alt sammen i en boks.", "Hell over litt olje."] } } },
            { day: "Fredag", theme: "Fisketaco (Middelhavs-vri)", lunchKid: "Pastasalat med mais & eple", lunchAdult: "Omelett med spinat & fetaost", dinner: "Fisketaco med torsk & mangosalsa", iconName: "fish", color: "text-purple-600", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Fisketaco med torsk", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800&auto=format&fit=crop", desc: "En frisk og sunn start p√• helgen.", servings: 4, time: "25 min", nutrition: { calories: "480", protein: "32g", fat: "16g", carbs: "46g" }, ingredients: ["500g torskefilet", "Tacokrydder", "Tortillas", "1 mango", "1/2 r√∏dk√•l", "R√∏mme", "Lime"], steps: ["Del torsken i terninger og stek med tacokrydder.", "Kutt opp mango og r√∏dk√•l.", "Varm tortillaene.", "Server som taco."] }, lunchKid: { title: "Pastasalat", image: "https://images.unsplash.com/photo-1623428187969-5da2dcea5ebf?q=80&w=800&auto=format&fit=crop", desc: "Perfekt m√•te √• bruke opp rester av pasta.", servings: 1, time: "5 min", nutrition: { calories: "290", protein: "9g", fat: "9g", carbs: "40g" }, ingredients: ["Kokt pasta", "Mais", "Eple", "Agurk"], steps: ["Bland alt sammen."] }, lunchAdult: { title: "Spinatomelett", image: "https://images.unsplash.com/photo-1510693206972-df098062cb71?q=80&w=800&auto=format&fit=crop", desc: "Proteinrik lunsj.", servings: 1, time: "10 min", nutrition: { calories: "310", protein: "21g", fat: "24g", carbs: "4g" }, ingredients: ["2 egg", "Spinat", "Fetaost"], steps: ["Stek spinat raskt.", "Hell over eggene og dryss med feta."] } } }
        ];

        const week2Data = [
            { day: "Mandag", theme: "Fisk & Ingef√¶r-kick", lunchKid: "Matmuffins med spinat & feta", lunchAdult: "Caprese-salat med tomat & mozzarella", dinner: "Laks med ingef√¶r, soya & sesam", iconName: "fish", color: "text-rose-600", image: "https://images.unsplash.com/photo-1543826173-70651703c5a4?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Ingef√¶r-glasert Laks", image: "https://images.unsplash.com/photo-1543826173-70651703c5a4?q=80&w=800&auto=format&fit=crop", desc: "Smaksrik fiskemiddag som lager seg selv i ovnen.", servings: 4, time: "20 min", timers: [{ label: "Bake laks", minutes: 15 }], nutrition: { calories: "550", protein: "38g", fat: "30g", carbs: "22g" }, ingredients: ["4 laksefileter", "3 ss soyasaus", "1 ss honning", "1 ss revet ingef√¶r", "Sesamfr√∏", "Brokkoli", "Fullkornsris/Nudler"], steps: ["Bland soya, honning og ingef√¶r.", "Legg laksen i form og hell sausen over.", "Bak i ovnen p√• 200 grader i 12-15 min.", "Str√∏ over sesamfr√∏ ved servering."] }, lunchKid: { title: "Matmuffins m/Spinat", image: "https://images.unsplash.com/photo-1620063251786-b4d618d35091?q=80&w=800", desc: "Lag opp p√• s√∏ndag - holder hele uken!", servings: 12, time: "30 min", timers: [{ label: "Steke muffins", minutes: 18 }], nutrition: { calories: "180", protein: "8g", fat: "10g", carbs: "15g" }, ingredients: ["3 egg", "3 dl grovt mel", "1 ts bakepulver", "100g spinat (hakket)", "100g fetaost", "1 dl melk"], steps: ["Bland egg og melk.", "R√∏r inn det t√∏rre og fyllet.", "Stek i muffinsformer p√• 200 grader i ca 15-20 min."] }, lunchAdult: { title: "Caprese Salat", image: "https://images.unsplash.com/photo-1529312266912-b33cf6227e2f?q=80&w=800&auto=format&fit=crop", desc: "Enkelt, friskt og italiensk.", servings: 1, time: "5 min", nutrition: { calories: "320", protein: "18g", fat: "24g", carbs: "6g" }, ingredients: ["1 mozzarella-ball", "2 tomater", "Fersk basilikum", "Olivenolje", "Balsamico"], steps: ["Skj√¶r tomat og mozzarella i skiver.", "Legg lagvis p√• tallerken.", "Topp med basilikum, olje og litt salt."] } } },
            { day: "Tirsdag", theme: "Gresk Aften", lunchKid: "Fullkornspasta med gr√∏nn pesto & erter", lunchAdult: "Rester av Ingef√¶r-laks", dinner: "Kylling Souvlaki med Tzatziki", iconName: "utensils-crossed", color: "text-sky-700", image: "https://images.unsplash.com/photo-1532592309856-1c32483864b4?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Kylling Souvlaki", image: "https://images.unsplash.com/photo-1532592309856-1c32483864b4?q=80&w=800&auto=format&fit=crop", desc: "Greske smaker som barna liker.", servings: 4, time: "25 min", nutrition: { calories: "450", protein: "42g", fat: "18g", carbs: "30g" }, ingredients: ["400g kyllingfilet", "Oregano", "Sitron", "Hvitl√∏k", "Tzatziki", "Fullkornspita/Lefser", "Agurk & Tomat"], steps: ["Mariner kyllingbiter i olje, sitron og oregano.", "Stek i panne eller p√• spyd i ovnen.", "Server i pita med tzatziki og salat."] }, lunchKid: { title: "Pesto-pasta", image: "https://images.unsplash.com/photo-1473093295043-cdd812d0e601?q=80&w=800", desc: "Kald pasta er super matpakke-mat.", servings: 1, time: "5 min", nutrition: { calories: "350", protein: "10g", fat: "12g", carbs: "50g" }, ingredients: ["Kokt fullkornspasta", "1 ss pesto", "Frosne erter (tiner i boksen)"], steps: ["Bland pasta med pesto og erter.", "Legg gjerne ved noen cherrytomater."] }, lunchAdult: { title: "Laks & Brokkoli (rester)", image: "https://images.unsplash.com/photo-1543826173-70651703c5a4?q=80&w=800", desc: "Smakene setter seg enda bedre til i dag.", servings: 1, time: "2 min", nutrition: { calories: "550", protein: "38g", fat: "30g", carbs: "22g" }, ingredients: ["Laks", "Ris", "Brokkoli"], steps: ["Varm opp."] } } },
            { day: "Onsdag", theme: "Suppe-onsdag", lunchKid: "Yoghurt med granola & b√¶r + knekkebr√∏d", lunchAdult: "Kylling-wrap (rester fra tirsdag)", dinner: "Hvit Minestronesuppe med b√∏nner", iconName: "chef-hat", color: "text-emerald-600", image: "https://images.unsplash.com/photo-1620916566398-39f1143ab7be?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Hvit Minestrone", image: "https://images.unsplash.com/photo-1620916566398-39f1143ab7be?q=80&w=800&auto=format&fit=crop", desc: "En lys og lett suppe full av gr√∏nnsaker.", servings: 4, time: "20 min", timers: [{ label: "Koke poteter m√∏re", minutes: 15 }], nutrition: { calories: "320", protein: "16g", fat: "8g", carbs: "42g" }, ingredients: ["1 boks hvite b√∏nner", "Poteter i terninger", "Gulrot", "Stangselleri", "Gr√∏nnsakskraft", "Litt fullkornspasta"], steps: ["Kutt alle gr√∏nnsaker i sm√• terninger.", "Fres i gryta.", "Hell p√• kraft og kok til potetene er m√∏re.", "Ha i b√∏nner og pasta mot slutten."] }, lunchKid: { title: "Yoghurt-lunsj", image: "https://images.unsplash.com/photo-1488477181946-6428a0291777?q=80&w=800", desc: "Friskt og godt.", servings: 1, time: "2 min", nutrition: { calories: "300", protein: "15g", fat: "8g", carbs: "40g" }, ingredients: ["Naturell yoghurt", "Granola", "B√¶r", "1 grovt knekkebr√∏d med ost"], steps: ["Ha yoghurt i tett boks, granola ved siden av."] }, lunchAdult: { title: "Kylling i pita (rester)", image: "https://images.unsplash.com/photo-1532592309856-1c32483864b4?q=80&w=800", desc: "Kald souvlaki er digg!", servings: 1, time: "2 min", nutrition: { calories: "450", protein: "42g", fat: "18g", carbs: "30g" }, ingredients: ["Kylling", "Pita", "Tzatziki"], steps: ["Pakk inn restene."] } } },
            { day: "Torsdag", theme: "Anti-inflammatorisk & Gurkemeie", lunchKid: "Fiskekaker i grovbr√∏d", lunchAdult: "Tunfisksalat med egg & r√∏dl√∏k", dinner: "Gyllen kikertgryte med gurkemeie", iconName: "leaf", color: "text-amber-600", image: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Gyllen kikertgryte", image: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?q=80&w=800&auto=format&fit=crop", desc: "En sunn middag med kraften fra gurkemeie.", servings: 4, time: "25 min", timers: [{ label: "Sm√•koke", minutes: 15 }], nutrition: { calories: "380", protein: "14g", fat: "12g", carbs: "45g" }, ingredients: ["2 bokser kikerter", "1 ss gurkemeie", "1 boks kokosmelk", "1 l√∏k", "Ingef√¶r (fersk)", "Spinat", "Fullkornsris til servering"], steps: ["Fres l√∏k, hvitl√∏k og revet ingef√¶r i olje.", "Tilsett gurkemeie og la det frese litt.", "Ha i kikerter og kokosmelk. La sm√•koke i 15 min.", "Vend inn spinat f√∏r servering."] }, lunchKid: { title: "Fiskekake-lunsj", image: "https://images.unsplash.com/photo-1565557623262-b51c2513a641?q=80&w=800", desc: "Kald fiskekake er bedre enn du tror!", servings: 1, time: "1 min", nutrition: { calories: "250", protein: "15g", fat: "10g", carbs: "25g" }, ingredients: ["1-2 fiskekaker (80% fisk)", "1 grovbr√∏dskive", "Agurk"], steps: ["Pakk fiskekaken i lompe eller ha p√• br√∏d."] }, lunchAdult: { title: "Tunfisksalat", image: "https://images.unsplash.com/photo-1543340904-991f3751a30f?q=80&w=800", desc: "Proteinbombe.", servings: 1, time: "10 min", nutrition: { calories: "380", protein: "40g", fat: "18g", carbs: "10g" }, ingredients: ["1 boks tunfisk i vann", "1 kokt egg", "R√∏dl√∏k", "Salatblader", "Litt olivenolje/sitron"], steps: ["Bland tunfisk med hakket r√∏dl√∏k og litt dressing.", "Server p√• en seng av salat med eggb√•ter."] } } },
            { day: "Fredag", theme: "Middelhavs-Taco", lunchKid: "Polarbr√∏d-pizza m/paprika", lunchAdult: "Omelett med tomat & basilikum", dinner: "Halloumi-tacos med mangosalsa", iconName: "smile", color: "text-orange-500", image: "https://images.unsplash.com/photo-1551504734-5ee1c4a1479b?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Halloumi-tacos", image: "https://images.unsplash.com/photo-1551504734-5ee1c4a1479b?q=80&w=800&auto=format&fit=crop", desc: "En morsom vri p√• fredagstacoen.", servings: 4, time: "20 min", nutrition: { calories: "560", protein: "24g", fat: "38g", carbs: "34g" }, ingredients: ["1 pk Halloumi-ost", "Sm√• fullkornstortillas", "1 mango", "Avokado/Guacamole", "Chili", "Lime"], steps: ["Kutt mango og avokado i terninger (salsa).", "Stek skiver av halloumi i pannen til gylne.", "Server i varme tortillas med salsa og lime."] }, lunchKid: { title: "Polarbr√∏d-pizza", image: "https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?q=80&w=800", desc: "Lages kvelden f√∏r eller om morgenen.", servings: 1, time: "10 min", nutrition: { calories: "320", protein: "14g", fat: "12g", carbs: "35g" }, ingredients: ["Grovt Polarbr√∏d", "Tomatpur√©", "Mozzarella", "Paprika/Tomat"], steps: ["Sm√∏r tomatpur√© p√• polarbr√∏d.", "Ha p√• ost og gr√∏nnsaker.", "Gratiner i ovnen til osten smelter. Avkj√∏l."] }, lunchAdult: { title: "Tomat-omelett", image: "https://images.unsplash.com/photo-1510693206972-df098062cb71?q=80&w=800", desc: "Enkel proteinlunsj.", servings: 1, time: "10 min", nutrition: { calories: "300", protein: "20g", fat: "22g", carbs: "5g" }, ingredients: ["2 egg", "Tomater", "Basilikum", "Parmesan"], steps: ["Pisk egg.", "Stek i panne med tomater.", "Topp med urter."] } } }
        ];

        const week3Data = [
            { day: "Mandag", theme: "Raske Fiskekaker", lunchKid: "Yoghurt & Banan", lunchAdult: "Fullkornswrap med kyllingp√•legg", dinner: "Fiskekaker med r√•kost og poteter", iconName: "fish", color: "text-blue-600", image: "https://images.unsplash.com/photo-1565557623262-b51c2513a641?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Fiskekaker med r√•kost", image: "https://images.unsplash.com/photo-1565557623262-b51c2513a641?q=80&w=800&auto=format&fit=crop", desc: "Klassiker som alle liker. Ferdige fiskekaker gj√∏r det raskt.", servings: 4, time: "20 min", timers: [{ label: "Koke poteter", minutes: 20 }], nutrition: { calories: "450", protein: "25g", fat: "15g", carbs: "40g" }, ingredients: ["800g Fiskekaker (80% fisk)", "8-10 Poteter", "3 Gulr√∏tter", "1 Eple", "Sitron", "R√∏mme"], steps: ["Kok poteter i lettsaltet vann.", "Riv gulr√∏tter og eple til r√•kost. Press over sitron.", "Varm fiskekakene i pannen med litt sm√∏r."] }, lunchKid: { title: "Yoghurt & Banan", image: "https://images.unsplash.com/photo-1488477181946-6428a0291777?q=80&w=800", desc: "Enkelt og greit.", servings: 1, time: "2 min", ingredients: ["Yoghurt naturell", "1 Banan", "Litt musli/n√∏tter"], steps: ["Bland og spis."] }, lunchAdult: { title: "Kyllingwrap", image: "https://images.unsplash.com/photo-1626700051175-6818013e1d4f?q=80&w=800", desc: "Enkel wrap.", servings: 1, time: "5 min", ingredients: ["Fullkornslefse", "Kyllingp√•legg (hvitt kj√∏tt)", "Spinat", "Pesto"], steps: ["Sm√∏r pesto, legg p√• p√•legg, rull."] } } },
            { day: "Tirsdag", theme: "Vegetar-fest", lunchKid: "Ostesm√∏rbr√∏d m/tomat", lunchAdult: "Fiskekake p√• skive", dinner: "Vegetarlasagne med linser", iconName: "leaf", color: "text-green-600", image: "https://images.unsplash.com/photo-1574868302505-1a98629a8a7c?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Vegetarlasagne", image: "https://images.unsplash.com/photo-1574868302505-1a98629a8a7c?q=80&w=800&auto=format&fit=crop", desc: "Mettende lasagne der kj√∏ttdeig er byttet ut med r√∏de linser.", servings: 4, time: "45 min", timers: [{ label: "Steke lasagne", minutes: 30 }], nutrition: { calories: "520", protein: "22g", fat: "20g", carbs: "55g" }, ingredients: ["Fullkornslasagneplater", "2 bokser hakkede tomater", "2 dl r√∏de linser", "1 l√∏k", "Hvit saus/Bechamel", "Ost"], steps: ["Lag tomatsaus med linser, l√∏k og krydder.", "Legg lagvis med plater og hvit saus.", "Topp med ost. Stek p√• 200 grader."] }, lunchKid: { title: "Ostesm√∏rbr√∏d", image: "https://images.unsplash.com/photo-1588612455956-2582855f308a?q=80&w=800", desc: "Varm lunsj er luksus.", servings: 1, time: "10 min", ingredients: ["Grovbr√∏d", "Ost", "Tomatskiver", "Pesto (i stedet for skinke)"], steps: ["Stek i ovn eller pannes."] }, lunchAdult: { title: "Fiskekake-skive", image: "https://images.unsplash.com/photo-1565557623262-b51c2513a641?q=80&w=800", desc: "Rester fra mandag.", servings: 1, time: "2 min", ingredients: ["Fiskekake", "Grovbr√∏d", "Majones/Remulade"], steps: ["Legg p√• br√∏d."] } } },
            { day: "Onsdag", theme: "Kylling Wok & Ingef√¶r", lunchKid: "Smoothie & Knekkebr√∏d", lunchAdult: "Lasagne-rester", dinner: "Kyllingwok med nudler & ingef√¶r", iconName: "utensils-crossed", color: "text-orange-600", image: "https://images.unsplash.com/photo-1585032226651-759b368d7246?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Kyllingwok", image: "https://images.unsplash.com/photo-1585032226651-759b368d7246?q=80&w=800&auto=format&fit=crop", desc: "Masse gr√∏nnsaker og raskt ferdig.", servings: 4, time: "20 min", timers: [{ label: "Koke nudler", minutes: 4 }], nutrition: { calories: "480", protein: "35g", fat: "12g", carbs: "50g" }, ingredients: ["400g Kylling", "Fullkornsnudler", "Wok-blanding", "Soyasaus", "Fersk Ingef√¶r", "Chili (valgfritt)"], steps: ["Kok nudler.", "Stek kylling i strimler.", "Ha i gr√∏nnsaker, finhakket ingef√¶r og fres raskt.", "Bland alt med soya."] }, lunchKid: { title: "Smoothie", image: "https://images.unsplash.com/photo-1505252585461-04db1eb84625?q=80&w=800", desc: "Vitaminbombe.", servings: 1, time: "5 min", ingredients: ["Frosne b√¶r", "Banan", "Yoghurt"], steps: ["Kj√∏r i blender."] }, lunchAdult: { title: "Lasagne-lunsj", image: "https://images.unsplash.com/photo-1574868302505-1a98629a8a7c?q=80&w=800", desc: "Bedre dagen etter.", servings: 1, time: "3 min", ingredients: ["Lasagne"], steps: ["Varm opp."] } } },
            { day: "Torsdag", theme: "Gyllen Suppe", lunchKid: "Eggemuffins", lunchAdult: "Wok-rester", dinner: "Gyllen Blomk√•lsuppe", iconName: "chef-hat", color: "text-yellow-600", image: "https://images.unsplash.com/photo-1547592166-23ac45744acd?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Gyllen Blomk√•lsuppe", image: "https://images.unsplash.com/photo-1547592166-23ac45744acd?q=80&w=800&auto=format&fit=crop", desc: "Hjemmelaget er best! N√• med gurkemeie.", servings: 4, time: "25 min", timers: [{ label: "Koke blomk√•l", minutes: 15 }], nutrition: { calories: "250", protein: "8g", fat: "15g", carbs: "12g" }, ingredients: ["2 Blomk√•lhoder", "1 L√∏k", "8dl Kraft", "2dl Melk", "1 ts Gurkemeie", "Fullkornsbr√∏d ved siden av"], steps: ["Stek l√∏k.", "Ha i blomk√•l, kraft og gurkemeie. Kok m√∏rt.", "Kj√∏r glatt med stavmikser (ta av noen buketter f√∏rst).", "R√∏r inn melk. Server med br√∏d."] }, lunchKid: { title: "Eggemuffins", image: "https://images.unsplash.com/photo-1525351484163-7529414395d8?q=80&w=800", desc: "Egg og gr√∏nnsaker i form.", servings: 1, time: "20 min", ingredients: ["Egg", "Spinat", "Fetaost"], steps: ["Visp sammen, stek i muffinsform."] }, lunchAdult: { title: "Wok-lunsj", image: "https://images.unsplash.com/photo-1585032226651-759b368d7246?q=80&w=800", desc: "Kald eller varm.", servings: 1, time: "2 min", ingredients: ["Wok"], steps: ["Spis."] } } },
            { day: "Fredag", theme: "Hjemmelaget Pizza", lunchKid: "Suppe p√• termos", lunchAdult: "Salat med egg", dinner: "Grov Pizza med Mozzarella", iconName: "smile", color: "text-red-600", image: "https://images.unsplash.com/photo-1513104890138-7c749659a591?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Grov Pizza", image: "https://images.unsplash.com/photo-1513104890138-7c749659a591?q=80&w=800&auto=format&fit=crop", desc: "Litt sunnere fredagskos.", servings: 4, time: "40 min", timers: [{ label: "Heve deig", minutes: 20 }, { label: "Steke pizza", minutes: 15 }], nutrition: { calories: "600", protein: "28g", fat: "22g", carbs: "65g" }, ingredients: ["Fullkornsmel", "Gj√¶r", "Tomatsaus", "Mozzarella", "Paprika & R√∏dl√∏k", "Ruccola"], steps: ["Lag deig og la heve.", "Kjevle ut, ha p√• saus og ost.", "Stek p√• 225 grader.", "Legg p√• ruccola etter steking."] }, lunchKid: { title: "Termos-suppe", image: "https://images.unsplash.com/photo-1547592166-23ac45744acd?q=80&w=800", desc: "Resten av blomk√•lsuppa.", servings: 1, time: "2 min", ingredients: ["Suppe"], steps: ["Varm opp og ha p√• termos."] }, lunchAdult: { title: "Eggesalat", image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?q=80&w=800", desc: "Enkel salat.", servings: 1, time: "5 min", ingredients: ["Salat", "Egg", "Tomat"], steps: ["Bland."] } } }
        ];

        const week4Data = [
            { day: "Mandag", theme: "Torsk i form", lunchKid: "Kj√∏leskapsgr√∏t", lunchAdult: "Salat med kikerter og feta", dinner: "Torsk i form med pesto", iconName: "fish", color: "text-blue-500", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Torsk med pesto", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800&auto=format&fit=crop", desc: "Superenkel fiskemiddag.", servings: 4, time: "25 min", timers: [{ label: "Ovnsbake", minutes: 15 }], nutrition: { calories: "420", protein: "35g", fat: "25g", carbs: "10g" }, ingredients: ["600g Torskefilet", "Gr√∏nn pesto", "Cherrytomater", "Fl√∏te (lett)", "Fullkornsris"], steps: ["Legg fisk i form.", "Sm√∏r p√• pesto, ha i tomater og en skvett fl√∏te.", "Bak p√• 200 grader i ca 15 min."] }, lunchKid: { title: "Kj√∏leskapsgr√∏t", image: "https://images.unsplash.com/photo-1516054575922-f0b8eeadec1a?q=80&w=800", desc: "Lages kvelden f√∏r.", servings: 1, time: "0 min", ingredients: ["Havregryn", "Melk/Yoghurt", "Eple", "Kanel"], steps: ["Bland i glass, la st√• i kj√∏leskap over natten."] }, lunchAdult: { title: "Kikertsalat", image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?q=80&w=800", desc: "Proteinrik salat.", servings: 1, time: "5 min", ingredients: ["Kikerter", "Fetaost", "R√∏dl√∏k", "Tomat"], steps: ["Skyll kikerter. Bland alt."] } } },
            { day: "Tirsdag", theme: "Chili Sin Carne", lunchKid: "Makrell i tomat-skive", lunchAdult: "Torske-rester", dinner: "Chili Sin Carne", iconName: "leaf", color: "text-red-700", image: "https://images.unsplash.com/photo-1526318896980-cf78c088247c?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Chili Sin Carne", image: "https://images.unsplash.com/photo-1526318896980-cf78c088247c?q=80&w=800&auto=format&fit=crop", desc: "Kj√∏ttfri chili med b√∏nner og sjokolade (!).", servings: 4, time: "30 min", timers: [{ label: "Koke gryte", minutes: 20 }], nutrition: { calories: "380", protein: "18g", fat: "10g", carbs: "45g" }, ingredients: ["2 bokser Kidneyb√∏nner", "1 boks tomater", "L√∏k & Hvitl√∏k", "Chili", "Paprika", "Mais", "M√∏rk sjokolade (1 bit)", "Fullkornsris"], steps: ["Fres l√∏k, hvitl√∏k og chili.", "Ha i tomater og b√∏nner. Kok opp.", "Smak til med krydder og en bit sjokolade.", "Server med ris."] }, lunchKid: { title: "Makrell i tomat", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800", desc: "Klassisk og sunt.", servings: 1, time: "2 min", ingredients: ["Grovbr√∏d", "Makrell i tomat", "Agurk"], steps: ["Sm√∏r."] }, lunchAdult: { title: "Fiskelunsj", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800", desc: "Rester.", servings: 1, time: "2 min", ingredients: ["Torsk"], steps: ["Varm."] } } },
            { day: "Onsdag", theme: "Greske Kyllingkaker", lunchKid: "Fruktbeger & N√∏tter", lunchAdult: "Chili-rester", dinner: "Greske Kyllingkaker (Keftedes)", iconName: "utensils-crossed", color: "text-emerald-700", image: "https://images.unsplash.com/photo-1529692236671-f1f6cf9683ba?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Greske Kyllingkaker", image: "https://images.unsplash.com/photo-1529692236671-f1f6cf9683ba?q=80&w=800&auto=format&fit=crop", desc: "Saftige kaker av hvitt kj√∏tt med middelhavssmaker.", servings: 4, time: "30 min", timers: [{ label: "Steke kaker", minutes: 12 }, { label: "Ovnsbake poteter", minutes: 25 }], nutrition: { calories: "480", protein: "35g", fat: "18g", carbs: "35g" }, ingredients: ["400g Kyllingkj√∏ttdeig", "Poteter", "Hvitl√∏k & Oregano", "Fetaost", "Agurk & Yoghurt (til tzatziki)", "Salat"], steps: ["Kutt poteter i b√•ter, vend i olje og bak i ovn.", "Bland kyllingkj√∏ttdeig med hvitl√∏k, oregano og litt fetaost.", "Form til kaker og stek gylne i pannen.", "Server med tzatziki og salat."] }, lunchKid: { title: "Frukt & N√∏tter", image: "https://images.unsplash.com/photo-1565557623262-b51c2513a641?q=80&w=800", desc: "Energi.", servings: 1, time: "5 min", ingredients: ["Eple", "P√¶re", "Valn√∏tter"], steps: ["Kutt opp."] }, lunchAdult: { title: "Chili-lunsj", image: "https://images.unsplash.com/photo-1526318896980-cf78c088247c?q=80&w=800", desc: "Varmer godt.", servings: 1, time: "2 min", ingredients: ["Chili Sin Carne"], steps: ["Varm opp."] } } },
            { day: "Torsdag", theme: "Suppe & Gurkemeie-gull", lunchKid: "Kald Kyllingkake", lunchAdult: "Kyllingkake-sm√∏rbr√∏d", dinner: "Gulrot & Linsesuppe med Gurkemeie", iconName: "chef-hat", color: "text-orange-500", image: "https://images.unsplash.com/photo-1547592180-85f173990554?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Gulrot & Linsesuppe m/Gurkemeie", image: "https://images.unsplash.com/photo-1547592180-85f173990554?q=80&w=800&auto=format&fit=crop", desc: "Billig, sunt og godt.", servings: 4, time: "25 min", timers: [{ label: "Koke suppe", minutes: 20 }], nutrition: { calories: "300", protein: "12g", fat: "8g", carbs: "40g" }, ingredients: ["500g Gulr√∏tter", "2dl R√∏de Linser", "L√∏k", "Ingef√¶r", "1 ts Gurkemeie", "Kraft", "Appelsinjuice (litt)"], steps: ["Fres l√∏k, ingef√¶r og gulrot.", "Ha i gurkemeie, linser og kraft. Kok m√∏rt.", "Kj√∏r glatt. Smak til med litt juice."] }, lunchKid: { title: "Kyllingkake", image: "https://images.unsplash.com/photo-1529692236671-f1f6cf9683ba?q=80&w=800", desc: "Rester fra onsdag.", servings: 1, time: "0 min", ingredients: ["Kyllingkake"], steps: ["Pakk ned."] }, lunchAdult: { title: "Sm√∏rbr√∏d", image: "https://images.unsplash.com/photo-1529692236671-f1f6cf9683ba?q=80&w=800", desc: "Med r√∏dbeter.", servings: 1, time: "2 min", ingredients: ["Grovbr√∏d", "Kyllingkake", "R√∏dbeter"], steps: ["Lag sm√∏rbr√∏d."] } } },
            { day: "Fredag", theme: "Tex-Mex", lunchKid: "Suppe-rester", lunchAdult: "Suppe-rester", dinner: "Kylling Enchiladas", iconName: "smile", color: "text-yellow-600", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800&auto=format&fit=crop", recipes: { dinner: { title: "Kylling Enchiladas", image: "https://images.unsplash.com/photo-1599974579688-8dbdd335c77f?q=80&w=800&auto=format&fit=crop", desc: "Gratinerte wraps i ovn.", servings: 4, time: "35 min", timers: [{ label: "Gratinere", minutes: 15 }], nutrition: { calories: "600", protein: "35g", fat: "25g", carbs: "50g" }, ingredients: ["Fullkornstortillas", "Kylling", "Mais", "Salsa", "R√∏mme", "Ost"], steps: ["Stek kylling og bland med salsa og mais.", "Fyll lefser, rull sammen og legg i form.", "Str√∏ over ost. Stek p√• 200 grader til osten er gyllen."] }, lunchKid: { title: "Suppe", image: "https://images.unsplash.com/photo-1547592180-85f173990554?q=80&w=800", desc: "P√• termos.", servings: 1, time: "2 min", ingredients: ["Suppe"], steps: ["Varm."] }, lunchAdult: { title: "Suppe", image: "https://images.unsplash.com/photo-1547592180-85f173990554?q=80&w=800", desc: "Lunsj.", servings: 1, time: "2 min", ingredients: ["Suppe"], steps: ["Varm."] } } }
        ];

        const viralData = [
            { 
                title: "Dalgona Coffee ‚òï", 
                image: "https://images.unsplash.com/photo-1587888637140-84919d36d56d?q=80&w=800", 
                desc: "Den originale virale kaffen! Luftig, s√∏t og instagram-vennlig.", 
                time: "10 min", 
                servings: 1,
                type: "Drikke",
                week: "X",
                day: "Kos",
                timers: [{ label: "Piske kaffe", minutes: 5 }],
                nutrition: { calories: "200", protein: "4g", fat: "4g", carbs: "35g" },
                ingredients: ["2 ss Instant kaffe", "2 ss Sukker", "2 ss Varmt vann", "2 dl Melk", "Isbiter"], 
                steps: ["Ha kaffe, sukker og varmt vann i en bolle.", "Pisk med h√•ndmikser (eller visp) til det blir tykt og lyst skum.", "Fyll et glass med isbiter og melk.", "Topp melken med det luftige kaffeskummet."] 
            },
            { 
                title: "Smash Burger üçî", 
                image: "https://images.unsplash.com/photo-1568901346375-23c9450c58cd?q=80&w=800", 
                desc: "Ultimat helgemat med spr√∏ stekeskorpe!", 
                time: "20 min", 
                servings: 4,
                type: "Middag",
                week: "X",
                day: "Helg",
                timers: [{ label: "Steke", minutes: 3 }],
                nutrition: { calories: "800", protein: "30g", fat: "50g", carbs: "40g" },
                ingredients: ["500g kj√∏ttdeig (h√∏y fettprosent)", "Brioche br√∏d", "Cheddarost", "Sylteagurk", "Burgerdressing", "L√∏k"], 
                steps: ["Del kj√∏ttdeigen i 4 kuler (ikke kna).", "Varm pannen maks.", "Legg kulene i, 'smash' dem flate med en stekespade.", "Salt og pepper. Stek 2 min.", "Snu, ha p√• ost, stek 1 min til.", "Server i ristet br√∏d."] 
            },
            { 
                title: "Dirty Fries üçü", 
                image: "https://images.unsplash.com/photo-1630384060421-cb20d0e0649d?q=80&w=800", 
                desc: "Pommes frites toppet med alt som er godt.", 
                time: "30 min", 
                servings: 4,
                type: "Snack",
                week: "X",
                day: "Helg",
                timers: [{ label: "Fries i ovn", minutes: 20 }],
                nutrition: { calories: "900", protein: "20g", fat: "60g", carbs: "70g" },
                ingredients: ["Pommes Frites", "Bacon", "Cheddar", "V√•rl√∏k", "Jalapenos", "R√∏mme/Dressing"], 
                steps: ["Stek fries spr√∏ i ovnen.", "Stek baconterninger.", "Str√∏ ost og bacon over fries de siste 3 min i ovnen.", "Topp med r√∏mme, v√•rl√∏k og chili."] 
            },
            { 
                title: "Creamy Mac & Cheese üßÄ", 
                image: "https://images.unsplash.com/photo-1516100882582-96c3e0c292b6?q=80&w=800", 
                desc: "Amerikansk klassiker.", 
                time: "25 min", 
                servings: 4,
                type: "Middag",
                week: "X",
                day: "Helg",
                timers: [{ label: "Koke makaroni", minutes: 8 }],
                nutrition: { calories: "750", protein: "25g", fat: "40g", carbs: "60g" },
                ingredients: ["400g Makaroni", "50g Sm√∏r", "50g Mel", "6dl Melk", "300g Cheddar/Ost", "Paprikakrydder"], 
                steps: ["Kok makaroni.", "Lag jevning av sm√∏r og mel, spe med melk til tykk saus.", "Smelt inn all osten.", "Vend inn makaroni."] 
            },
            { 
                title: "Spicy Fried Chicken üçó", 
                image: "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?q=80&w=800", 
                desc: "Spr√∏, saftig og litt sterk.", 
                time: "40 min", 
                servings: 4,
                type: "Middag",
                week: "X",
                day: "Helg",
                timers: [{ label: "Fritere", minutes: 12 }],
                nutrition: { calories: "650", protein: "40g", fat: "35g", carbs: "30g" },
                ingredients: ["Kyllingl√•r/vinger", "Kefir", "Mel", "Krydder (Paprika, Chili, Hvitl√∏k)", "Olje til steking"], 
                steps: ["Vend kylling i kefir, s√• i krydret mel.", "Gjenta for tykkere skorpe.", "Stek i olje i dyp panne til gylne og gjennomstekte."] 
            },
            { 
                title: "Baked Feta Pasta üçù", 
                image: "https://images.unsplash.com/photo-1611270629669-1afc8a775c7e?q=80&w=800", 
                desc: "Retten som '√∏dela' internett! Superenkelt og kremet.", 
                time: "35 min", 
                servings: 4,
                type: "Middag",
                week: "X",
                day: "Hverdag",
                timers: [{ label: "Bake i ovn", minutes: 30 }],
                nutrition: { calories: "600", protein: "20g", fat: "35g", carbs: "55g" },
                ingredients: ["1 blokk Fetaost", "2 kurver Cherrytomater", "Pasta", "Olivenolje", "Hvitl√∏k", "Fersk Basilikum"], 
                steps: ["Legg fetaost i midten av en form, tomater rundt.", "Hell over olje, salt, pepper.", "Bak p√• 200 grader i 30 min.", "Kok pasta.", "Mos osten og tomatene sammen, bland inn pasta."] 
            },
            { 
                title: "Salmon Rice Bowl üçö", 
                image: "https://images.unsplash.com/photo-1512058564366-18510be2db19?q=80&w=800", 
                desc: "Emily Marikos virale restemat-hack.", 
                time: "5 min", 
                servings: 1,
                type: "Lunsj",
                week: "X",
                day: "Hverdag",
                timers: [],
                nutrition: { calories: "500", protein: "30g", fat: "25g", carbs: "45g" },
                ingredients: ["Rest av laks", "Kokt ris", "Isbit", "Soyasaus", "Sriracha", "Majones", "Avokado", "Kimchi/Tang"], 
                steps: ["Legg laks og ris p√• tallerken. Legg en isbit i risen.", "Dekk med bakepapir og varm i mikroen (isbiten damper risen!).", "Bland inn soya, sriracha og majones.", "Spis med avokado og tang."] 
            },
            { 
                title: "Tortilla Wrap Hack üåÆ", 
                image: "https://images.unsplash.com/photo-1626071466175-721d6eb104e7?q=80&w=800", 
                desc: "Det smarte brette-trikset for perfekte wraps.", 
                time: "10 min", 
                servings: 1,
                type: "Lunsj",
                week: "X",
                day: "Hverdag",
                timers: [{ label: "Steke wrap", minutes: 3 }],
                nutrition: { calories: "400", protein: "20g", fat: "20g", carbs: "35g" },
                ingredients: ["1 stor Tortilla", "Fyll 1: Ost", "Fyll 2: Skinke/Kylling", "Fyll 3: Salat/Tomat", "Fyll 4: Saus/Pesto"], 
                steps: ["Lag et snitt fra midten og ned.", "Legg fyll i hver av de fire 'kvadrantene'.", "Brett den ene delen over den andre, hele veien rundt.", "Stek i panne/toastjern."] 
            },
            { 
                title: "Pesto Eggs üç≥", 
                image: "https://images.unsplash.com/photo-1525351484163-7529414395d8?q=80&w=800", 
                desc: "Stek eggene i pesto i stedet for olje - gamechanger!", 
                time: "5 min", 
                servings: 1,
                type: "Frokost",
                week: "X",
                day: "Helg",
                timers: [],
                nutrition: { calories: "350", protein: "14g", fat: "28g", carbs: "10g" },
                ingredients: ["2 Egg", "2 ss Gr√∏nn Pesto", "Br√∏dskive", "Chiliolje (valgfritt)"], 
                steps: ["Varm pesto i en stekepanne.", "Knekk eggene oppi pestoen.", "Stek til √∏nsket konsistens.", "Server p√• ristet br√∏d."] 
            },
            { 
                title: "Cloud Bread ‚òÅÔ∏è", 
                image: "https://images.unsplash.com/photo-1589302168068-964664d93dc0?q=80&w=800", 
                desc: "Superluftig, fargerikt og mykt som en sky.", 
                time: "30 min", 
                servings: 1,
                type: "Bakst",
                week: "X",
                day: "Helg",
                timers: [{ label: "Bake", minutes: 25 }],
                nutrition: { calories: "150", protein: "10g", fat: "0g", carbs: "25g" },
                ingredients: ["3 Eggehviter", "30g Sukker", "10g Maizena", "Konditorfarge (valgfritt)"], 
                steps: ["Pisk eggehviter stive.", "Tilsett sukker litt og litt, s√• maizena.", "Form til en bolle p√• stekebrett.", "Stek p√• 150 grader i ca 25 min."] 
            },
            { 
                title: "Mini Pancake Cereal ü•û", 
                image: "https://images.unsplash.com/photo-1598214886806-c87b84b7078b?q=80&w=800", 
                desc: "Bittesm√• pannekaker i en bolle med melk.", 
                time: "20 min", 
                servings: 2,
                type: "Frokost",
                week: "X",
                day: "Helg",
                timers: [],
                nutrition: { calories: "400", protein: "10g", fat: "15g", carbs: "60g" },
                ingredients: ["Pannekaker√∏re (p√• flaske er enklest)", "Sm√∏r", "Sirup", "Melk"], 
                steps: ["Lag mange bittesm√• klatter med r√∏re i pannen.", "Stek gyldne.", "Ha i en sk√•l, topp med sm√∏r og sirup, eller spis med melk som frokostblanding."] 
            },
            { 
                title: "Oreo Mug Cake üßÅ", 
                image: "https://images.unsplash.com/photo-1574085733277-851d9d856a3a?q=80&w=800", 
                desc: "Kake klar p√• 2 minutter med kun 2 ingredienser.", 
                time: "2 min", 
                servings: 1,
                type: "Dessert",
                week: "X",
                day: "Kos",
                timers: [{ label: "Mikro", minutes: 1 }],
                nutrition: { calories: "350", protein: "5g", fat: "15g", carbs: "50g" },
                ingredients: ["4-5 Oreo-kjeks", "3-4 ss Melk"], 
                steps: ["Knus kjeksen i en kopp.", "R√∏r inn melk til en r√∏re.", "Kj√∏r i mikroen i ca 1 minutt (sjekk underveis)."] 
            }
        ];

        const shoppingListWeek1 = {
            "Frukt & Gr√∏nt": ["Kiwi", "Pasjonsfrukt", "Agurk (1)", "Paprika (2)", "Spinat", "Cherrytomater", "S√∏tpotet (2)", "Gulr√∏tter", "Brokkoli", "Ruccola", "Avokado", "R√∏dk√•l", "L√∏k & Hvitl√∏k", "Ingef√¶r", "Chili"],
            "Kj√∏l & Meieri": ["R√∏kelaks", "Makrell i tomat", "Brunost", "Sn√∏frisk", "Fetaost", "Egg (12)", "Melk", "Yoghurt", "R√∏mme", "Sm√∏r"],
            "T√∏rrvarer": ["Hakkede tomater (4)", "Kikerter", "Kokosmelk", "Mais", "R√∏de linser", "Quinoa", "Ris", "Fullkornspasta", "Havregryn", "Grovbr√∏d", "Fullkornslefser", "Nanbr√∏d", "N√∏tter", "Pesto", "Buljong"],
            "Fisk & Kj√∏tt": ["Laksefileter (4)", "Torskefilet", "Kyllingfilet", "Kalkunp√•legg"]
        };

        const shoppingListWeek2 = {
            "Frukt & Gr√∏nt": ["Kiwi", "Pasjonsfrukt", "L√∏k & Hvitl√∏k", "Ingef√¶r (fersk)", "Spinat", "Tomater (4-5)", "Agurk", "Avokado (2)", "Mango (2)", "Poteter", "Gulrot", "Stangselleri", "Fersk Basilikum", "Sitron & Lime"],
            "Kj√∏l & Meieri": ["Mozzarella (1)", "Halloumi (1 pk)", "Tzatziki (eller yoghurt)", "Egg (12)", "Melk", "Ost (revet)", "Sm√∏r"],
            "T√∏rrvarer": ["Kikerter (2 bokser)", "Kokosmelk (1 boks)", "Soyasaus", "Sesamfr√∏", "Honning", "Hvite b√∏nner (1 boks)", "Fullkornsris", "Fullkornspita", "Fullkornstortillas", "Tunfisk (boks)", "Granola", "Fullkornspasta", "Pesto", "Grovt Knekkebr√∏d", "Makrell i tomat"],
            "Fisk & Kj√∏tt": ["Laksefileter (4)", "Kyllingfilet (400g)", "Fiskekaker (80% fisk)"]
        };

        const shoppingListWeek3 = { "Frukt & Gr√∏nt": ["Poteter (10-15)", "Gulr√∏tter (1 kg)", "Eple (2)", "L√∏k (3)", "Wok-blanding", "Blomk√•l (2)", "Spinat", "Ruccola", "Banan"], "Kj√∏l & Meieri": ["Fiskekaker (800g)", "R√∏mme", "Fl√∏te/Melk (2dl)", "Ost (revet)", "Mozzarella", "Spekeskinke (1 pk)", "Egg (6)", "Sm√∏r", "Yoghurt"], "T√∏rrvarer": ["Fullkornslasagneplater", "Hakkede tomater (3 bokser)", "R√∏de linser", "Fullkornsnudler", "Soyasaus", "Fullkornsmel", "Gj√¶r", "Tomatsaus (pizza)", "Grovt Knekkebr√∏d", "Musli"], "Fisk & Kj√∏tt": ["Kyllingfilet (400g)", "Bacon (lite)"] };
        const shoppingListWeek4 = { "Frukt & Gr√∏nt": ["Cherrytomater", "L√∏k & Hvitl√∏k (mye)", "Chili", "Paprika (2)", "Poteter", "Gulr√∏tter (500g)", "Ingef√¶r", "Mais (2 bokser)", "Appelsin", "Eple/P√¶re/Druer", "Agurk"], "Kj√∏l & Meieri": ["Fl√∏te (3dl)", "R√∏mme", "Ost (revet)", "Brunost?", "Melk"], "T√∏rrvarer": ["Gr√∏nn pesto", "Fullkornsris", "Kidneyb√∏nner (2 bokser)", "Hakkede tomater (1 boks)", "M√∏rk sjokolade", "Brun saus pose", "Ertestuing (boks)", "R√∏de linser", "Salsa", "Fullkornstortillas", "Makrell i tomat"], "Fisk & Kj√∏tt": ["Torskefilet (600g)", "Kyllingkj√∏ttdeig (400g)", "Kylling (400g)"] };

        const App = () => {
            const [activeTab, setActiveTab] = useState('menu');
            const [currentWeek, setCurrentWeek] = useState(1);
            const [checkedItems, setCheckedItems] = useState({});
            const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
            
            // Recipe & App States - MED PERSISTENCE
            const [currentRecipe, setCurrentRecipe] = useState(() => {
                try {
                    const saved = localStorage.getItem('familienBro-activeRecipe');
                    return saved ? JSON.parse(saved) : null;
                } catch { return null; }
            });
            
            const [recipeServings, setRecipeServings] = useState(4);
            const [completedSteps, setCompletedSteps] = useState(new Set());
            const [ratings, setRatings] = useState({});
            
            // Search States
            const [searchTags, setSearchTags] = useState([]);
            const [searchInputValue, setSearchInputValue] = useState("");
            const [searchMode, setSearchMode] = useState('OR'); 
            
            // Multiple Timers State - MED PERSISTENCE
            const [activeTimers, setActiveTimers] = useState(() => {
                try {
                    const saved = localStorage.getItem('familienBro-timers');
                    return saved ? JSON.parse(saved) : [];
                } catch { return []; }
            });

            // History handling (Browser Back Button)
            useEffect(() => {
                // Initial replace to ensure valid state
                if (!window.history.state) {
                    window.history.replaceState({ tab: 'menu' }, '', window.location.pathname);
                }

                const handlePopState = (event) => {
                    if (event.state && event.state.tab) {
                        setActiveTab(event.state.tab);
                        if (event.state.recipe) {
                            setCurrentRecipe(event.state.recipe);
                        }
                    } else {
                        // Fallback til meny hvis ingen state (f.eks. ved reload/f√∏rste load)
                        setActiveTab('menu');
                    }
                };

                window.addEventListener('popstate', handlePopState);
                return () => window.removeEventListener('popstate', handlePopState);
            }, []);

            // Helper to navigate and push history
            const navigateToTab = (tab, recipe = null) => {
                setActiveTab(tab);
                if (recipe) setCurrentRecipe(recipe);
                
                // Optional: Update URL hash
                const hash = recipe ? '#oppskrift' : (tab === 'menu' ? '#' : `#${tab}`);
                window.history.pushState({ tab, recipe }, '', hash);
                
                if (tab === 'recipe') window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            // Lagre currentRecipe n√•r den endres
            useEffect(() => {
                if (currentRecipe) {
                    localStorage.setItem('familienBro-activeRecipe', JSON.stringify(currentRecipe));
                }
            }, [currentRecipe]);

            const allRecipes = useMemo(() => {
                const recipes = [];
                const add = (rec, type, day, week) => { if(rec) recipes.push({...rec, type, day, week}); };
                const processWeek = (data, w) => data.forEach(d => {
                    add(d.recipes.dinner, 'Middag', d.day, w);
                    add(d.recipes.lunchKid, 'Lunsj (Barn)', d.day, w);
                    add(d.recipes.lunchAdult, 'Lunsj (Voksen)', d.day, w);
                });
                processWeek(week1Data, 1);
                processWeek(week2Data, 2);
                processWeek(week3Data, 3);
                processWeek(week4Data, 4);
                // Add viral recipes (no specific week/day filtering usually, but searchable)
                viralData.forEach(v => recipes.push(v));
                return recipes;
            }, []);

            useEffect(() => {
                try {
                    const savedList = localStorage.getItem(`familienBro-handleliste-uke${currentWeek}`);
                    if (savedList) setCheckedItems(JSON.parse(savedList));
                    const savedRatings = localStorage.getItem('familienBro-ratings');
                    if (savedRatings) setRatings(JSON.parse(savedRatings));
                } catch (e) { console.error(e); }
            }, [currentWeek]);

            let activeMenuData, activeShoppingList;
            if (currentWeek === 1) { activeMenuData = week1Data; activeShoppingList = shoppingListWeek1; }
            else if (currentWeek === 2) { activeMenuData = week2Data; activeShoppingList = shoppingListWeek2; }
            else if (currentWeek === 3) { activeMenuData = week3Data; activeShoppingList = shoppingListWeek3; }
            else { activeMenuData = week4Data; activeShoppingList = shoppingListWeek4; }

            const filteredAllRecipes = allRecipes.filter(r => {
                if (searchTags.length === 0 && !searchInputValue) return true;
                const terms = [...searchTags];
                if (searchInputValue.trim()) terms.push(searchInputValue.trim());
                const checkTerm = (term) => {
                    const q = term.toLowerCase();
                    return r.title.toLowerCase().includes(q) || r.ingredients.some(i => i.toLowerCase().includes(q));
                };
                return searchMode === 'OR' ? terms.some(checkTerm) : terms.every(checkTerm);
            });

            const toggleItem = (key) => {
                const newState = { ...checkedItems, [key]: !checkedItems[key] };
                setCheckedItems(newState);
                localStorage.setItem(`familienBro-handleliste-uke${currentWeek}`, JSON.stringify(newState));
            };

            const resetList = () => {
                if(confirm('Vil du nullstille listen for denne uken?')) {
                    setCheckedItems({});
                    localStorage.removeItem(`familienBro-handleliste-uke${currentWeek}`);
                }
            };

            const handleRecipeClick = (e, recipe) => {
                if (e) e.stopPropagation(); 
                if (recipe) {
                    setRecipeServings(recipe.servings);
                    setCompletedSteps(new Set());
                    // Use navigation helper for history support
                    navigateToTab('recipe', recipe);
                }
            };

            const handleRating = (stars) => {
                if (!currentRecipe) return;
                const newRatings = { ...ratings, [currentRecipe.title]: stars };
                setRatings(newRatings);
                localStorage.setItem('familienBro-ratings', JSON.stringify(newRatings));
            };

            const toggleStep = (index) => {
                setCompletedSteps(prev => {
                    const next = new Set(prev);
                    if (next.has(index)) {
                        next.delete(index);
                    } else {
                        next.add(index);
                    }
                    return next;
                });
            };

            const getScaledIngredient = (ing) => {
                const match = ing.match(/^([\d.,]+)/);
                if (match && currentRecipe) {
                    const originalVal = parseFloat(match[0].replace(',', '.'));
                    if (!isNaN(originalVal)) {
                        const scaledVal = (originalVal / currentRecipe.servings) * recipeServings;
                        const formatted = Number.isInteger(scaledVal) ? scaledVal : scaledVal.toFixed(1);
                        return ing.replace(match[0], formatted);
                    }
                }
                return ing;
            };

            const addTimer = (minutes, label) => {
                playStartSound();
                const newTimer = {
                    id: Date.now(),
                    label: label || "Timer",
                    recipeTitle: currentRecipe ? currentRecipe.title : "", // New: Store Recipe Title
                    timeRemaining: minutes * 60,
                    active: true,
                    finished: false,
                    acknowledged: false
                };
                setActiveTimers(prev => {
                    const updated = [...prev, newTimer];
                    localStorage.setItem('familienBro-timers', JSON.stringify(updated));
                    return updated;
                });
            };

            return (
                <div className="min-h-screen flex flex-col pb-20">
                    <header className="bg-lime-900 text-white shadow-lg sticky top-0 z-40 no-print">
                        <div className="max-w-4xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => navigateToTab('menu')}>
                                <Icon name="leaf" className="w-6 h-6 text-lime-300" />
                                <h1 className="text-xl font-bold tracking-tight hidden sm:block">Familien Bro</h1>
                            </div>
                            
                            {activeTab === 'menu' && (
                                <div className="flex bg-lime-950/50 rounded-lg p-1 mx-2 overflow-x-auto">
                                    {[1, 2, 3, 4].map(w => (
                                        <button key={w} onClick={() => setCurrentWeek(w)} className={`px-2.5 py-1 text-xs font-bold rounded-md transition-all whitespace-nowrap ${currentWeek === w ? 'bg-white text-lime-900 shadow' : 'text-lime-200 hover:text-white'}`}>Uke {w}</button>
                                    ))}
                                </div>
                            )}

                            <nav className="hidden md:flex gap-1 bg-lime-950/30 p-1 rounded-lg">
                                {['menu', 'all_recipes', 'viral', 'shopping', 'recipe'].map((tab) => (
                                    <button
                                        key={tab}
                                        onClick={() => navigateToTab(tab)}
                                        className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${activeTab === tab ? 'bg-white text-lime-900 shadow-sm' : 'text-lime-100 hover:bg-lime-800'}`}
                                    >
                                        {tab === 'menu' && 'Meny'}
                                        {tab === 'all_recipes' && 'Oppskrifter'}
                                        {tab === 'viral' && 'Viralt üçî'}
                                        {tab === 'shopping' && 'Liste'}
                                        {tab === 'recipe' && 'Aktiv'}
                                    </button>
                                ))}
                                <a href="trening.html" className="px-4 py-1.5 rounded-md text-sm font-medium transition-all text-lime-100 hover:bg-lime-800 flex items-center gap-1">Trening</a>
                            </nav>

                            <button className="md:hidden p-2" onClick={() => setMobileMenuOpen(!mobileMenuOpen)}>
                                <Icon name={mobileMenuOpen ? "x" : "menu"} className="w-6 h-6" />
                            </button>
                        </div>

                        {mobileMenuOpen && (
                            <div className="md:hidden bg-lime-900 border-t border-lime-700">
                                <div className="flex flex-col p-2 space-y-1">
                                    {['menu', 'all_recipes', 'viral', 'shopping', 'recipe'].map((tab) => (
                                        <button key={tab} onClick={() => { navigateToTab(tab); setMobileMenuOpen(false); }} className={`px-4 py-3 rounded-md text-left font-medium ${activeTab === tab ? 'bg-lime-800 text-white' : 'text-lime-100'}`}>
                                            {tab === 'menu' && 'üìÖ Ukesmeny'}
                                            {tab === 'all_recipes' && 'üç≤ Alle Oppskrifter'}
                                            {tab === 'viral' && 'üçî Viralt'}
                                            {tab === 'shopping' && 'üõí Handleliste'}
                                            {tab === 'recipe' && 'üç≥ Aktiv'}
                                        </button>
                                    ))}
                                    <a href="trening.html" className="px-4 py-3 rounded-md text-left font-medium text-lime-100 hover:bg-lime-800">üí™ Trening</a>
                                </div>
                            </div>
                        )}
                    </header>

                    <main className="max-w-4xl mx-auto px-4 py-6 md:py-10 w-full flex-grow">
                        
                        <FloatingTimerList activeTimers={activeTimers} setActiveTimers={setActiveTimers} />

                        {activeTab === 'menu' && (
                            <div className="space-y-6 animate-fade-in">
                                <div className="text-center mb-8">
                                    <h2 className="text-3xl font-bold text-stone-800 mb-2">Ukesmeny - Uke {currentWeek}</h2>
                                    <p className="text-stone-600">Trykk p√• middag eller lunsj for √• se oppskriften</p>
                                </div>

                                <div className="grid gap-6 md:grid-cols-1">
                                    {activeMenuData.map((day, idx) => (
                                        <div 
                                            key={idx} 
                                            onClick={(e) => handleRecipeClick(e, day.recipes.dinner)}
                                            className="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden flex flex-col md:flex-row hover:shadow-lg transition-all cursor-pointer clickable-card group"
                                        >
                                            <div className="h-48 md:w-48 md:h-auto relative bg-stone-200 shrink-0">
                                                <img src={day.image} alt={day.dinner} className="w-full h-full object-cover transition-transform group-hover:scale-105 duration-500" />
                                                <div className="absolute top-0 left-0 bg-sky-700 text-white px-3 py-1 text-sm font-bold rounded-br-lg">
                                                    {day.day}
                                                </div>
                                            </div>
                                            <div className="p-6 flex-1 flex flex-col justify-center">
                                                <div className="flex items-center justify-between mb-3">
                                                    <div className="flex items-center gap-2">
                                                        <Icon name={day.iconName} className={`w-5 h-5 ${day.color}`} />
                                                        <span className="text-xs font-semibold uppercase tracking-wider text-stone-500 border border-stone-200 px-2 py-0.5 rounded-full">
                                                            {day.theme}
                                                        </span>
                                                    </div>
                                                    <div className="text-lime-700 opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1 text-xs font-medium">
                                                        Se middag <Icon name="chevron-right" className="w-4 h-4" />
                                                    </div>
                                                </div>
                                                <div className="space-y-3">
                                                    <div>
                                                        <h3 className="text-lg font-bold text-stone-800 leading-tight mb-1 group-hover:text-lime-800 transition-colors">{day.dinner}</h3>
                                                        <p className="text-sm text-stone-500 flex items-center gap-1"><Icon name="utensils-crossed" className="w-3 h-3" /> Middag</p>
                                                    </div>
                                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 pt-3 border-t border-stone-100">
                                                        <div 
                                                            onClick={(e) => handleRecipeClick(e, day.recipes.lunchKid)}
                                                            className={`p-2 rounded-lg transition-colors border border-transparent ${day.recipes.lunchKid ? 'bg-orange-50 hover:bg-orange-100 hover:border-orange-200 cursor-pointer lunch-card' : 'bg-stone-50'}`}
                                                        >
                                                            <div className="flex justify-between items-start">
                                                                <p className="text-xs font-bold text-orange-800 uppercase mb-0.5">Lunsj Barn</p>
                                                                {day.recipes.lunchKid && <Icon name="arrow-up-right" className="w-3 h-3 text-orange-400" />}
                                                            </div>
                                                            <p className="text-sm text-stone-700 leading-snug">{day.lunchKid}</p>
                                                        </div>

                                                        <div 
                                                            onClick={(e) => handleRecipeClick(e, day.recipes.lunchAdult)}
                                                            className={`p-2 rounded-lg transition-colors border border-transparent ${day.recipes.lunchAdult ? 'bg-sky-50 hover:bg-sky-100 hover:border-sky-200 cursor-pointer lunch-card' : 'bg-stone-50 opacity-70'}`}
                                                        >
                                                            <div className="flex justify-between items-start">
                                                                <p className="text-xs font-bold text-sky-800 uppercase mb-0.5">Lunsj Voksen</p>
                                                                {day.recipes.lunchAdult && <Icon name="arrow-up-right" className="w-3 h-3 text-sky-400" />}
                                                            </div>
                                                            <p className="text-sm text-stone-700 leading-snug">{day.lunchAdult}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'viral' && (
                            <div className="animate-fade-in">
                                <div className="text-center mb-8">
                                    <h2 className="text-3xl font-bold text-stone-800 mb-2">Virale Hits üçî</h2>
                                    <p className="text-stone-600">N√•r du vil ha noe skikkelig digg (uten regler)!</p>
                                </div>
                                <div className="grid gap-6 grid-cols-1 md:grid-cols-2">
                                    {viralData.map((recipe, idx) => (
                                        <div 
                                            key={idx} 
                                            onClick={() => handleRecipeClick(null, recipe)}
                                            className="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden hover:shadow-lg transition-all cursor-pointer flex flex-col"
                                        >
                                            <div className="h-40 relative bg-stone-200">
                                                <img src={recipe.image} alt={recipe.title} className="w-full h-full object-cover" />
                                                <div className="absolute top-2 right-2 bg-red-600 text-white px-2 py-1 rounded text-xs font-bold shadow-sm">
                                                    üî• VIRAL
                                                </div>
                                            </div>
                                            <div className="p-4 flex-grow flex flex-col justify-between">
                                                <div>
                                                    <h3 className="font-bold text-stone-800 text-lg leading-tight mb-2">{recipe.title}</h3>
                                                    <p className="text-sm text-stone-500 line-clamp-2">{recipe.desc}</p>
                                                </div>
                                                <div className="mt-4 flex items-center gap-4 text-xs text-stone-400">
                                                    <div className="flex items-center gap-1"><Icon name="clock" className="w-3 h-3" /> {recipe.time}</div>
                                                    {ratings[recipe.title] && (
                                                        <div className="flex items-center gap-1 text-yellow-500"><Icon name="star" className="w-3 h-3 fill-current" /> {ratings[recipe.title]}</div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'all_recipes' && (
                            <div className="animate-fade-in">
                                <div className="text-center mb-8">
                                    <h2 className="text-3xl font-bold text-stone-800 mb-4">Alle Oppskrifter</h2>
                                    
                                    {/* TAG S√òK / T√òM KJ√òLESKAPET */}
                                    <div className="max-w-md mx-auto relative mb-6">
                                        <div className="flex justify-center gap-2 mb-3">
                                            <button 
                                                onClick={() => setSearchMode('OR')}
                                                className={`px-3 py-1 text-xs font-bold rounded-full transition-all border ${searchMode === 'OR' ? 'bg-lime-600 text-white border-lime-600 shadow-sm' : 'bg-white text-stone-500 border-stone-200 hover:bg-stone-50'}`}
                                            >
                                                Minst √©n ingrediens
                                            </button>
                                            <button 
                                                onClick={() => setSearchMode('AND')}
                                                className={`px-3 py-1 text-xs font-bold rounded-full transition-all border ${searchMode === 'AND' ? 'bg-lime-600 text-white border-lime-600 shadow-sm' : 'bg-white text-stone-500 border-stone-200 hover:bg-stone-50'}`}
                                            >
                                                Alle ingredienser
                                            </button>
                                        </div>

                                        <TagSearchInput 
                                            tags={searchTags} 
                                            setTags={setSearchTags}
                                            inputValue={searchInputValue}
                                            setInputValue={setSearchInputValue}
                                            placeholder="T√∏m kj√∏leskapet (skriv ingrediens, trykk enter...)"
                                        />
                                        <p className="text-xs text-stone-400 mt-2 text-center">
                                            {searchMode === 'OR' 
                                                ? "Viser oppskrifter som inneholder noen av ingrediensene." 
                                                : "Viser kun oppskrifter som inneholder ALT du har skrevet inn."}
                                        </p>
                                    </div>
                                </div>

                                <div className="grid gap-6 grid-cols-1 md:grid-cols-2">
                                    {filteredAllRecipes.length === 0 && (
                                        <div className="text-center py-10 text-stone-500 col-span-full">
                                            Ingen oppskrifter funnet med disse ingrediensene ü•¨
                                        </div>
                                    )}
                                    {filteredAllRecipes.map((recipe, idx) => (
                                        <div 
                                            key={idx} 
                                            onClick={() => handleRecipeClick(null, recipe)}
                                            className="bg-white rounded-xl shadow-sm border border-stone-200 overflow-hidden hover:shadow-lg transition-all cursor-pointer flex flex-col"
                                        >
                                            <div className="h-40 relative bg-stone-200">
                                                <img src={recipe.image} alt={recipe.title} className="w-full h-full object-cover" />
                                                <div className="absolute top-2 right-2 bg-white/90 backdrop-blur px-2 py-1 rounded text-xs font-bold text-stone-700">
                                                    {recipe.week === 'X' ? 'üî• VIRALT' : `Uke ${recipe.week} ‚Ä¢ ${recipe.day}`}
                                                </div>
                                            </div>
                                            <div className="p-4 flex-grow flex flex-col justify-between">
                                                <div>
                                                    <span className="text-xs font-bold text-lime-600 uppercase mb-1 block">{recipe.type}</span>
                                                    <h3 className="font-bold text-stone-800 text-lg leading-tight mb-2">{recipe.title}</h3>
                                                    <p className="text-sm text-stone-500 line-clamp-2">{recipe.desc}</p>
                                                </div>
                                                <div className="mt-4 flex items-center gap-4 text-xs text-stone-400">
                                                    <div className="flex items-center gap-1"><Icon name="clock" className="w-3 h-3" /> {recipe.time}</div>
                                                    {ratings[recipe.title] && (
                                                        <div className="flex items-center gap-1 text-yellow-500"><Icon name="star" className="w-3 h-3 fill-current" /> {ratings[recipe.title]}</div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'shopping' && (
                            <div className="max-w-2xl mx-auto animate-fade-in">
                                <div className="flex items-center justify-between mb-6 no-print">
                                    <h2 className="text-3xl font-bold text-stone-800">Handleliste (Uke {currentWeek})</h2>
                                    <div className="flex gap-3">
                                        <button onClick={() => window.print()} className="text-sm text-lime-700 hover:text-lime-900 font-medium flex items-center gap-1">
                                            <Icon name="printer" className="w-4 h-4 inline" /> Skriv ut
                                        </button>
                                        <button onClick={resetList} className="text-sm text-lime-700 hover:text-lime-900 font-medium">
                                            Nullstill
                                        </button>
                                    </div>
                                </div>

                                <div className="grid gap-6">
                                    {Object.entries(activeShoppingList).map(([category, items]) => (
                                        <div key={category} className="bg-white rounded-xl shadow-sm border border-stone-200 p-6 break-inside-avoid">
                                            <h3 className="text-lg font-bold text-lime-800 border-b border-lime-100 pb-2 mb-4">
                                                {category}
                                            </h3>
                                            <div className="space-y-3">
                                                {items.map((item, idx) => {
                                                    const key = `${category}-${idx}`;
                                                    const isChecked = checkedItems[key];
                                                    return (
                                                        <div 
                                                            key={key} 
                                                            onClick={() => toggleItem(key)}
                                                            className="flex items-start gap-3 cursor-pointer group select-none"
                                                        >
                                                            <div className={`mt-0.5 shrink-0 transition-colors ${isChecked ? 'text-lime-600' : 'text-stone-300 group-hover:text-lime-400'}`}>
                                                                <Icon name={isChecked ? "check-circle-2" : "circle"} className="w-5 h-5" />
                                                            </div>
                                                            <span className={`text-base transition-all ${isChecked ? 'text-stone-400 line-through decoration-stone-300' : 'text-stone-700'}`}>
                                                                {item}
                                                            </span>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'recipe' && (
                            currentRecipe ? (
                                <div className="max-w-2xl mx-auto bg-white rounded-2xl shadow-lg border border-stone-100 overflow-hidden animate-fade-in">
                                    <div className="h-64 relative bg-stone-800">
                                        <img src={currentRecipe.image} alt={currentRecipe.title} className="w-full h-full object-cover opacity-90" />
                                        <div className="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent flex items-end">
                                            <div className="p-8 text-white w-full">
                                                <div className="flex justify-between items-end">
                                                    <div>
                                                        <h2 className="text-3xl font-bold mb-2">{currentRecipe.title}</h2>
                                                        <p className="text-lg text-lime-200">{currentRecipe.desc}</p>
                                                    </div>
                                                    
                                                    <div className="flex flex-col items-end">
                                                        <div className="flex gap-1">
                                                            {[1,2,3,4,5].map(star => (
                                                                <button 
                                                                    key={star} 
                                                                    onClick={(e) => {e.stopPropagation(); handleRating(star)}}
                                                                    className={`transition-transform hover:scale-125 ${ratings[currentRecipe.title] >= star ? 'text-yellow-400 fill-yellow-400' : 'text-white/50'}`}
                                                                >
                                                                    <Icon name="star" className="w-6 h-6" />
                                                                </button>
                                                            ))}
                                                        </div>
                                                        <span className="text-xs text-lime-100 mt-1 uppercase tracking-widest">Matdommer</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="p-8">
                                        <div className="flex flex-wrap items-center justify-between gap-6 mb-6 text-sm text-stone-500 border-b border-stone-100 pb-6">
                                            <div className="flex gap-6">
                                                <div className="flex items-center gap-2"><Icon name="chef-hat" className="text-lime-600 w-5 h-5" /><span>Enkel</span></div>
                                                <div className="flex items-center gap-2"><Icon name="clock" className="text-lime-600 w-5 h-5" /><span>{currentRecipe.time}</span></div>
                                            </div>
                                            <div className="flex flex-wrap gap-2">
                                                {currentRecipe.timers && currentRecipe.timers.map((timer, i) => (
                                                    <button 
                                                        key={i}
                                                        onClick={() => addTimer(timer.minutes, timer.label)}
                                                        className="flex items-center gap-2 bg-stone-100 hover:bg-stone-200 px-3 py-1.5 rounded-full text-stone-700 transition-colors font-medium text-xs"
                                                    >
                                                        <Icon name="timer" className="w-4 h-4" /> {timer.label} ({timer.minutes} min)
                                                    </button>
                                                ))}
                                            </div>
                                        </div>

                                        {currentRecipe.nutrition && (
                                            <div className="bg-orange-50 rounded-xl p-4 mb-8 border border-orange-100">
                                                <h4 className="text-xs font-bold text-orange-800 uppercase tracking-wider mb-3">N√¶ringsinnhold pr. porsjon (ca.)</h4>
                                                <div className="grid grid-cols-4 gap-2 text-center">
                                                    <div className="bg-white p-2 rounded-lg shadow-sm">
                                                        <div className="text-lg font-bold text-stone-800">{currentRecipe.nutrition.calories}</div>
                                                        <div className="text-[10px] text-stone-500 uppercase">kcal</div>
                                                    </div>
                                                    <div className="bg-white p-2 rounded-lg shadow-sm">
                                                        <div className="text-lg font-bold text-stone-800">{currentRecipe.nutrition.protein}</div>
                                                        <div className="text-[10px] text-stone-500 uppercase">Protein</div>
                                                    </div>
                                                    <div className="bg-white p-2 rounded-lg shadow-sm">
                                                        <div className="text-lg font-bold text-stone-800">{currentRecipe.nutrition.fat}</div>
                                                        <div className="text-[10px] text-stone-500 uppercase">Fett</div>
                                                    </div>
                                                    <div className="bg-white p-2 rounded-lg shadow-sm">
                                                        <div className="text-lg font-bold text-stone-800">{currentRecipe.nutrition.carbs}</div>
                                                        <div className="text-[10px] text-stone-500 uppercase">Karb.</div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        <div className="grid md:grid-cols-2 gap-10">
                                            <div>
                                                <div className="flex items-center justify-between mb-4">
                                                    <h3 className="font-bold text-stone-800 text-lg flex items-center gap-2">
                                                        <span className="bg-lime-100 text-lime-800 w-6 h-6 rounded-full flex items-center justify-center text-xs">1</span>
                                                        Ingredienser
                                                    </h3>
                                                    <div className="flex items-center gap-3 bg-stone-100 px-3 py-1 rounded-full">
                                                        <button onClick={() => setRecipeServings(Math.max(1, recipeServings - 1))} className="text-stone-500 hover:text-stone-800"><Icon name="minus" className="w-4 h-4" /></button>
                                                        <span className="text-sm font-bold text-stone-800 w-4 text-center">{recipeServings}</span>
                                                        <button onClick={() => setRecipeServings(recipeServings + 1)} className="text-stone-500 hover:text-stone-800"><Icon name="plus" className="w-4 h-4" /></button>
                                                        <span className="text-xs text-stone-500 ml-1">porsjoner</span>
                                                    </div>
                                                </div>
                                                <ul className="space-y-2 text-stone-700">
                                                    {currentRecipe.ingredients.map((ing, i) => (
                                                        <li key={i} className="flex items-start gap-2 p-2 rounded-lg hover:bg-stone-50 transition-colors">
                                                            <span className="w-1.5 h-1.5 bg-lime-400 rounded-full mt-2 shrink-0"></span>
                                                            <span>{getScaledIngredient(ing)}</span>
                                                        </li>
                                                    ))}
                                                </ul>
                                            </div>

                                            <div>
                                                <h3 className="font-bold text-stone-800 text-lg mb-4 flex items-center gap-2">
                                                    <span className="bg-lime-100 text-lime-800 w-6 h-6 rounded-full flex items-center justify-center text-xs">2</span>
                                                    Fremgangsm√•te
                                                </h3>
                                                <ol className="space-y-4">
                                                    {currentRecipe.steps.map((step, i) => (
                                                        <li 
                                                            key={i} 
                                                            onClick={() => toggleStep(i)}
                                                            className={`flex gap-4 p-3 rounded-xl cursor-pointer transition-all border ${completedSteps.has(i) ? 'bg-stone-50 border-stone-200 step-checked' : 'bg-white border-transparent hover:border-lime-100 hover:shadow-sm'}`}
                                                        >
                                                            <div className={`mt-0.5 shrink-0 ${completedSteps.has(i) ? 'text-lime-500 block' : 'hidden'}`}>
                                                                <Icon name="check-circle-2" className="w-6 h-6" />
                                                            </div>
                                                            <div className={`mt-0.5 shrink-0 text-lime-700 ${completedSteps.has(i) ? 'hidden' : 'block'}`}>
                                                                <span className="font-bold text-lg font-mono">{i + 1}.</span>
                                                            </div>
                                                            <div className="pointer-events-none">
                                                                <p>{step}</p>
                                                            </div>
                                                        </li>
                                                    ))}
                                                </ol>
                                            </div>
                                        </div>
                                        
                                        <div className="mt-8 bg-sky-50 p-4 rounded-lg border border-sky-100">
                                            <h4 className="font-bold text-sky-800 mb-1 text-sm">üí° Tips fra Familien Bro</h4>
                                            <p className="text-sky-700 text-sm">
                                                Trykk p√• stegene over n√•r du er ferdig med dem for √• holde oversikten!
                                            </p>
                                        </div>

                                        <div className="mt-6 pt-6 border-t border-stone-100 text-center md:hidden">
                                            <button 
                                                onClick={() => navigateToTab('menu')}
                                                className="text-lime-700 font-medium hover:text-lime-900 text-sm flex items-center justify-center gap-2 w-full p-2"
                                            >
                                                <Icon name="arrow-left" className="w-4 h-4" /> Tilbake til menyen
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <div className="text-center py-20 animate-fade-in">
                                    <div className="inline-block p-4 bg-stone-100 rounded-full mb-4">
                                        <Icon name="chef-hat" className="w-12 h-12 text-stone-400" />
                                    </div>
                                    <h2 className="text-2xl font-bold text-stone-800 mb-2">Ingen aktiv oppskrift</h2>
                                    <p className="text-stone-500 mb-6">Velg en rett fra ukesmenyen eller s√∏k opp en oppskrift for √• se den her.</p>
                                    <button 
                                        onClick={() => navigateToTab('menu')}
                                        className="bg-lime-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-lime-700 transition-colors"
                                    >
                                        G√• til Meny
                                    </button>
                                </div>
                            )
                        )}
                    </main>

                    <footer className="bg-stone-800 text-stone-400 py-8 mt-12 text-center text-sm no-print">
                        <p>Familien Bro - Ukesmeny</p>
                        <p className="mt-1">Basert p√• middelhavsdietten üå±</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>